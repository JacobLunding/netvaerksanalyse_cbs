<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Analyse af strategiske netværksroller – Kursusmateriale til Virksomhedsstrategi i et netværksperspektiv</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-553db639d176b1f1e5eb8f34e19f9014.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Kursusmateriale til Virksomhedsstrategi i et netværksperspektiv</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Install_guide.html"> 
<span class="menu-text">Install and setup R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./intro.html"> 
<span class="menu-text">Intro til R og Tidyverse</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./kursusmateriale.html"> 
<span class="menu-text">Kursusmateriale</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#indlæs-data" id="toc-indlæs-data" class="nav-link" data-scroll-target="#indlæs-data">Indlæs data</a></li>
  <li><a href="#omkodninger" id="toc-omkodninger" class="nav-link" data-scroll-target="#omkodninger">Omkodninger</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">Filter</a></li>
  </ul></li>
  <li><a href="#fra-matricer-til-netværksobjekter" id="toc-fra-matricer-til-netværksobjekter" class="nav-link" data-scroll-target="#fra-matricer-til-netværksobjekter">Fra matricer til netværksobjekter</a>
  <ul class="collapse">
  <li><a href="#komponenter" id="toc-komponenter" class="nav-link" data-scroll-target="#komponenter">Komponenter</a>
  <ul class="collapse">
  <li><a href="#største-komponenter" id="toc-største-komponenter" class="nav-link" data-scroll-target="#største-komponenter">Største komponenter</a></li>
  </ul></li>
  <li><a href="#tilføj-vertex-attributes-der-ikke-er-beregnet-direkte-på-netværksobjektet." id="toc-tilføj-vertex-attributes-der-ikke-er-beregnet-direkte-på-netværksobjektet." class="nav-link" data-scroll-target="#tilføj-vertex-attributes-der-ikke-er-beregnet-direkte-på-netværksobjektet.">Tilføj vertex attributes der <em>ikke</em> er beregnet direkte på netværksobjektet.</a></li>
  <li><a href="#første-graf-plot" id="toc-første-graf-plot" class="nav-link" data-scroll-target="#første-graf-plot">Første graf plot</a></li>
  </ul></li>
  <li><a href="#netværksmål" id="toc-netværksmål" class="nav-link" data-scroll-target="#netværksmål">Netværksmål</a></li>
  <li><a href="#ego-netværk-og-lokalt-strategiske-netværkspositioner" id="toc-ego-netværk-og-lokalt-strategiske-netværkspositioner" class="nav-link" data-scroll-target="#ego-netværk-og-lokalt-strategiske-netværkspositioner">Ego-netværk og lokalt strategiske netværkspositioner</a>
  <ul class="collapse">
  <li><a href="#egonetværk-af-nabolag." id="toc-egonetværk-af-nabolag." class="nav-link" data-scroll-target="#egonetværk-af-nabolag.">Egonetværk af nabolag.</a></li>
  </ul></li>
  <li><a href="#constraint-eller-det-modsatte-brokerage" id="toc-constraint-eller-det-modsatte-brokerage" class="nav-link" data-scroll-target="#constraint-eller-det-modsatte-brokerage">Constraint eller det modsatte: <em>brokerage</em></a></li>
  <li><a href="#constraint-og-andre-centralitetsmål" id="toc-constraint-og-andre-centralitetsmål" class="nav-link" data-scroll-target="#constraint-og-andre-centralitetsmål">Constraint og andre centralitetsmål</a></li>
  <li><a href="#assortativity-assortative-mixing---homofili-i-netværk" id="toc-assortativity-assortative-mixing---homofili-i-netværk" class="nav-link" data-scroll-target="#assortativity-assortative-mixing---homofili-i-netværk">Assortativity (assortative mixing) - Homofili i netværk</a>
  <ul class="collapse">
  <li><a href="#assortativity-for-kontinuerte-variable" id="toc-assortativity-for-kontinuerte-variable" class="nav-link" data-scroll-target="#assortativity-for-kontinuerte-variable">Assortativity for kontinuerte variable</a></li>
  <li><a href="#assortativity-for-kategorielle-variable" id="toc-assortativity-for-kategorielle-variable" class="nav-link" data-scroll-target="#assortativity-for-kategorielle-variable">Assortativity for kategorielle variable</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analyse af strategiske netværksroller</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>I denne session bygger vi videre på nogle af koncenterne fra sidst (centralitet <a href="session3.html">se Session3</a>, transitivitet, netværks-lukning og strukturelle huller <a href="session4.html">se Session4</a>)</p>
<p>Først indlæser vi de pakker vi skal bruge:</p>
<p>Som tidligere kan I downloade opdaterede R scripts med hjælpe-funktioner her <a href="functions/custom_functions.R" class="btn btn-primary">Download costum_functions.R her</a></p>
<p><a href="functions/networkfunctions.R" class="btn btn-primary">Download networkfunctions.R her</a></p>
<p>De skal lige ‘sources’ så funktionerne ligger i vores global environment</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/networkfunctions.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/custom_functions.R"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="data" class="level1">
<h1>Data</h1>
<p>Til denne session har jeg hentet et datasæt fra Orbis med aktive virksomheder under <em>Activities and industry</em>: <strong>Industry classifications</strong> = NACE (21 - Manufacture of basic pharmaceutical products and pharmaceutical preparations) og <em>Loation</em> = World region/Country/Region in country: Nordic states</p>
<p><img src="images/orbis_pharma.png" class="img-fluid"></p>
<p>Af ekstra variable har jeg tilvalgt: Director &amp; Managers: Full name, UCI (Unique Contact Identifier), Job title (in English), Job title, Current or previous, Type of role, Board, committee or department, Level of responsibility, Gender, Birth place, Country/ies of nationality, Country</p>
<p>Ownership data (Shareholders): GUO - Name, GUO - BvD ID number, GUO - Country ISO code, DUO - Name, DUO - BvD ID number, DUO - Country ISO code, CSH - Name, CSH - BvD ID number, CSH - Country ISO code, Total assets th USD Last avail. yr.</p>
<p>I kan hente datafilen <a href="data/nordic_pharma2025.xlsx" class="btn btn-primary">her:</a></p>
<section id="indlæs-data" class="level2">
<h2 class="anchored" data-anchor-id="indlæs-data">Indlæs data</h2>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Unknown or uninitialised column: `assets`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Orbis variable names updated: 

DMFull name                                       =&gt; name
DMUCI (Unique Contact Identifier)                 =&gt; person_id
DMGender                                          =&gt; person_gender
DMCountry                                         =&gt; person_country
DMCountry/ies of nationality                      =&gt; person_countries
Company name Latin alphabet                       =&gt; affiliation
Country ISO code                                  =&gt; affiliation_country
DMJob title (in English)                          =&gt; role
DMBoard, committee or department                  =&gt; board_type
DMType of role                                    =&gt; role_type
DMLevel of responsibility                         =&gt; role_level
DMCurrent or previous                             =&gt; role_status
NACE Rev. 2, core code (4 digits)                 =&gt; sector
Operating revenue (Turnover) th USD Last avail. yr=&gt; revenue
Total assets th USD Last avail. yr                =&gt; total_assets
Number of employees Last avail. yr                =&gt; n_employees
CSH - BvD ID number                               =&gt; csh_id
CSH - Name                                        =&gt; csh_name
CSH - Country ISO code                            =&gt; csh_country
GUO - BvD ID number                               =&gt; guo_id
GUO - Name                                        =&gt; guo_name
GUO - Country ISO code                            =&gt; guo_country
DUO - BvD ID number                               =&gt; duo_id
DUO - Name                                        =&gt; duo_name
DUO - Country ISO code                            =&gt; duo_country


New variables added: 
person {TRUE/FALSE}</code></pre>
</div>
</div>
<p>Første blik på data:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 35
  name       person_id person_gender person_country person_countries affiliation
  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;      
1 Mr Helgel… P3347860… M             Norway         Norway;United S… NOVO NORDI…
2 Mr Helgel… P3347860… M             Norway         Norway;United S… NOVO NORDI…
3 Mr Jeppe … P0020235… M             &lt;NA&gt;           Denmark          NOVO NORDI…
4 Mr Soeren… P8278287… M             Denmark        Denmark          NOVO NORDI…
5 Mr Soeren… P8278287… M             Denmark        Denmark          NOVO NORDI…
6 Mr Soeren… P8278287… M             Denmark        Denmark          NOVO NORDI…
# ℹ 29 more variables: affiliation_country &lt;chr&gt;, role &lt;chr&gt;, board_type &lt;chr&gt;,
#   role_type &lt;chr&gt;, role_level &lt;chr&gt;, role_status &lt;chr&gt;, sector &lt;chr&gt;,
#   revenue &lt;dbl&gt;, total_assets &lt;chr&gt;, n_employees &lt;dbl&gt;, csh_id &lt;chr&gt;,
#   csh_name &lt;chr&gt;, csh_country &lt;chr&gt;, guo_id &lt;chr&gt;, guo_name &lt;chr&gt;,
#   guo_country &lt;chr&gt;, duo_id &lt;chr&gt;, duo_name &lt;chr&gt;, duo_country &lt;chr&gt;,
#   Inactive &lt;chr&gt;, Quoted &lt;chr&gt;, Branch &lt;chr&gt;, OwnData &lt;chr&gt;, Woco &lt;chr&gt;,
#   `Consolidation code` &lt;chr&gt;, `Last avail. year` &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="omkodninger" class="level2">
<h2 class="anchored" data-anchor-id="omkodninger">Omkodninger</h2>
<p>Vi laver en ny variabel, <code>executive</code>, som er <code>TRUE</code> hvise <code>role_type</code> indeholder <em>enten</em> “BoD” <em>eller</em> “ExeB” <em>eller</em> “SenMan” <em>eller</em> “ExeC” <strong>ELLER</strong> hvis <code>role</code> indeholder forskellige ord, der indikerer executive level:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="ot">&lt;-</span> pharma_nordic <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">executive =</span> <span class="fu">grepl</span>(<span class="st">"BoD|ExeB|SenMan|ExeC"</span>, role_type) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">"Director|directeur|Head of|general|Chief|executive|president|Chairman"</span>, role, <span class="at">ignore.case =</span>T))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Vi har hentet to forskellige variable på Orbis for personernes geografiske oprindelse: <code>person_country</code> og <code>person_contries</code>. Den første er fødested, den anden er countr(y/ies) of nationality.</p>
<p>Lad os se hvad fødested indeholder:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="sc">%&gt;%</span> <span class="fu">count</span>(person_country, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 2
   person_country               n
   &lt;chr&gt;                    &lt;int&gt;
 1 &lt;NA&gt;                      5781
 2 Denmark                    878
 3 Finland                    349
 4 Sweden                     349
 5 Switzerland                281
 6 Norway                     189
 7 Germany                    138
 8 United States of America   125
 9 Italy                      113
10 United Kingdom             102
# ℹ 28 more rows</code></pre>
</div>
</div>
<p>Som I kan se er der mange rækker med <code>NA</code> (missing). Måske kan vi bruge nationalitet til at udfylde nogle rækker:</p>
<p>Lad os se hvad værdien på countries er i de rækker hvor country er <code>NA</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(person_country)) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(person_countries, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="co"># Vi tager 10 tilfældige rækker</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   person_countries                 n
   &lt;chr&gt;                        &lt;int&gt;
 1 United Kingdom;United States     9
 2 United States;Canada             1
 3 Switzerland                      5
 4 United Kingdom                  90
 5 Denmark;Norway;Sweden            3
 6 Portugal                         1
 7 Denmark;Norway                  16
 8 Sweden;Norway                   18
 9 Netherlands;Sweden               4
10 Finland;United Kingdom           7</code></pre>
</div>
</div>
<p>Lad os lave en geografi-variabel <code>person_gep</code>, hvor vi bruger nationalitet når fødested er <code>NA</code> (der, hvor der er flere adskilt af “;”, lad da tage den første) og ellers bruger fødested (<code>.default= person_country</code>):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="ot">&lt;-</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person_geo =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(person_country)<span class="sc">~</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_extract</span>(person_countries, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">"(^.*?(?=;))|(^.*?$)"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">.default =</span> person_country))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Nu har vi færre <code>NA</code>’er:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="sc">%&gt;%</span> <span class="fu">count</span>(person_geo, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 2
   person_geo                   n
   &lt;chr&gt;                    &lt;int&gt;
 1 &lt;NA&gt;                      2270
 2 Sweden                    1804
 3 Denmark                   1214
 4 Norway                    1007
 5 Finland                    719
 6 Switzerland                286
 7 United Kingdom             226
 8 Germany                    179
 9 United States of America   125
10 United States              116
# ℹ 44 more rows</code></pre>
</div>
</div>
<p>Som I kan se står der både United States og United States of America, lad os også lige omkode det, så United States bliver til United States of America</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="ot">&lt;-</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person_geo =</span> <span class="fu">case_when</span>(person_geo <span class="sc">==</span> <span class="st">"United States"</span><span class="sc">~</span><span class="st">"United States of America"</span>, <span class="at">.default =</span> person_geo))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="filter" class="level2">
<h2 class="anchored" data-anchor-id="filter">Filter</h2>
<p>Som det sidste trin i data-behandlingen, lad os filtrere så vi kun har rækker, hvor bestyrelsesmedlemmet er en person, hvor rollen er aktiv og hvor vi med vores <code>executive</code> variabel gætter på at det er det højeste ledelsesniveau. Afslutningsvis sørger vi lige for at der ikke er dobbelt roller for samme person i samme virksomhed:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="ot">&lt;-</span> pharma_nordic <span class="sc">%&gt;%</span> <span class="fu">filter</span>(person <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="ot">&lt;-</span> pharma_nordic <span class="sc">%&gt;%</span> <span class="fu">filter</span>(role_status <span class="sc">==</span> <span class="st">"Current"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="ot">&lt;-</span> pharma_nordic <span class="sc">%&gt;%</span> <span class="fu">filter</span>(executive <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>pharma_nordic <span class="ot">&lt;-</span> pharma_nordic <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(name, affiliation, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="fra-matricer-til-netværksobjekter" class="level1">
<h1>Fra matricer til netværksobjekter</h1>
<p>Først laver vi en sparse bi_adjacency <code>individ x virksomhed</code>-matrice: <code>(..., formula = ~ name + affiliation)</code> giver en biadjacency matrice med <code>name</code> (individer) i rækker og <code>affiliation</code> (virksomheder) i kolonner.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bi_adj <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="at">data =</span> pharma_nordic, <span class="at">formula =</span> <span class="sc">~</span>name <span class="sc">+</span> affiliation, <span class="at">sparse =</span> T)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Når vi har denne matrice er det relaltivt simpelt at slette fx individer, der kun har en bestyrelsespost og dermed ikke binder nogen virksomheder sammen. Rækkesummen (<code>rowSums()</code>) på matricen fortæller os hvor mange poster et individ har:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rs <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(bi_adj)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(rs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>rs
   1    2    3    4 
2275  195   52   14 </code></pre>
</div>
</div>
<p>Der er relativt mange, som kun har én post. Lad os slette dem:</p>
<p><code>which(rs &gt; 1)</code> giver os index numrene for de positioner i vektoren der er større end én (læs: hvilke i rs er &gt; 1). Sætter vi dette udtryk ind på den første plads i de firkantede klammer efter et dataobjekt, <code>x[i , j]</code>, hvor førstepladsen refererer til rækker og andenpladsen til kolonner, så ‘fortæller’ vi R at vi gerne vil beholde de rækker, der svarer til at rækkesummen er &gt; 1.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bi_adj <span class="ot">&lt;-</span> bi_adj[<span class="fu">which</span>(rs <span class="sc">&gt;</span> <span class="dv">1</span>), ]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="grid">
<section id="virksomhedsnetværket" class="level2 g-col-6">
<h2 class="anchored" data-anchor-id="virksomhedsnetværket">Virksomhedsnetværket</h2>
</section>
<section id="individnetværket" class="level2 g-col-6">
<h2 class="anchored" data-anchor-id="individnetværket">Individnetværket</h2>
</section>
</div>
<p>Ved at gange vores biadjacency matrice med sig selv transponeret (<code>t()</code>). Matrix multiplikation <code>%*%</code> kræver at <code>Matrix</code> pakken er indlæst. Den ene vej t(x) %*% x giver relationerne mellem kolonnerne, den anden vej x %*% t(x)giver relationerne mellem rækkerne:</p>
<div class="grid">
<div class="g-col-6">
<p><span class="math inline">\(bi\_adj^T \times bi\_adj\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>adj_virk <span class="ot">&lt;-</span> <span class="fu">t</span>(bi_adj) <span class="sc">%*%</span> bi_adj</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div class="g-col-6">
<p><span class="math inline">\(bi\_adj \times bi\_adj^T\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>adj_ind <span class="ot">&lt;-</span> bi_adj <span class="sc">%*%</span> <span class="fu">t</span>(bi_adj)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<p>herfra kan vi vha <code>igraph</code> lave et netværksobjekt, som er <code>undirected</code> og ikke vægtet (derfor bruger vi <code>%&gt;% simplify()</code> til at slette multiple-edges):</p>
<div class="grid">
<div class="g-col-6">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>net_virk <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(<span class="at">adjmatrix =</span> adj_virk, <span class="at">mode =</span> <span class="st">"undirected"</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">simplify</span>()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>net_virk</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH 4fcae8c UN-- 596 266 -- 
+ attr: name (v/c)
+ edges from 4fcae8c (vertex names):
 [1] A/S ORTHANA KEMISK FABRIK--BIOFAC A/S                 
 [2] A/S ORTHANA KEMISK FABRIK--DANIPHARM A/S              
 [3] A/S ORTHANA KEMISK FABRIK--PHARMADAN A/S              
 [4] AAS PRODUKSJONSLAB AS    --CURIDA AS                  
 [5] AAS PRODUKSJONSLAB AS    --CURIDA HOLDING AS          
 [6] AETAS LABS APS           --SUPAR HEALTH APS           
 [7] AGILERA PHARMA AS        --IFE HOLDING AS             
 [8] AKI THERAPEUTICS A/S     --REPOCEUTICALS A/S          
+ ... omitted several edges</code></pre>
</div>
</div>
</div>
<div class="g-col-6">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>net_ind <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(<span class="at">adjmatrix =</span> adj_ind, <span class="at">mode =</span> <span class="st">"undirected"</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">simplify</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>net_ind</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH ee6bad1 UN-- 261 433 -- 
+ attr: name (v/c)
+ edges from ee6bad1 (vertex names):
 [1] David Lawrence Stern     --Dr Henrijette Elisabeth Richter
 [2] David Lawrence Stern     --Mr Mark Smith                  
 [3] David Lawrence Stern     --Mr Nicholas Haft               
 [4] David Lawrence Stern     --Mr Peter Finsel Bisgaard       
 [5] David Lawrence Stern     --Ms Claudia Maria Colciago      
 [6] David Lawrence Stern     --Ms Colleen Denise Acosta       
 [7] Dr Bert Roland Kari Junno--Mr Jan Nilsson                 
 [8] Dr Bert Roland Kari Junno--Mr Mikael Lindstam             
+ ... omitted several edges</code></pre>
</div>
</div>
</div>
</div>
<section id="komponenter" class="level2">
<h2 class="anchored" data-anchor-id="komponenter">Komponenter</h2>
<p>med funktionen <code>count_components</code> finder vi ud af hvor mange sammenhægende komponenter netværkene består af, og med en <code>table</code> på <code>components()$csize</code> kan vi se, hvor mange komponenter af forskellig størrelse der er:</p>
<div class="grid">
<div class="g-col-6">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count_components</span>(net_virk)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 405</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(net_virk)<span class="sc">$</span>csize <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
  1   2   3   4   5   6   7   9  13  63 
343  32  15   7   1   2   2   1   1   1 </code></pre>
</div>
</div>
<p>Vi har altså 343 isolerede virksomheder (komponenter med én virksomhed) og 32 par af virksomheder osv. og en stor komponent på 63 virksomheder</p>
</div>
<div class="g-col-6">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count_components</span>(net_ind)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 62</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">components</span>(net_ind)<span class="sc">$</span>csize <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
 1  2  3  4  5  6  7  8 16 77 
14 17 15  6  3  1  2  2  1  1 </code></pre>
</div>
</div>
<p>Vi har altså 14 isolerede individer. og 17 par af individer osv. og en stor komponent på 77 invidider.</p>
</div>
</div>
<section id="største-komponenter" class="level3">
<h3 class="anchored" data-anchor-id="største-komponenter">Største komponenter</h3>
<p>med <code>largest_component()</code> fra <em>igraph</em> og <code>get_n_largest_component()</code> fra <em>networkfunction.R</em> kan vi ‘udtrække’ hhv. den største og den n’te component fra netværket og gennem dette subnetværk som et selvstændigt objekt:</p>
<div class="grid">
<div class="g-col-6">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>comp1_virk <span class="ot">&lt;-</span> <span class="fu">largest_component</span>(net_virk)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>comp2_virk <span class="ot">&lt;-</span> <span class="fu">get_n_largest_component</span>(net_virk, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div class="g-col-6">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>comp1_ind <span class="ot">&lt;-</span> <span class="fu">largest_component</span>(net_ind)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>comp2_ind <span class="ot">&lt;-</span> <span class="fu">get_n_largest_component</span>(net_ind, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
</section>
<section id="tilføj-vertex-attributes-der-ikke-er-beregnet-direkte-på-netværksobjektet." class="level2">
<h2 class="anchored" data-anchor-id="tilføj-vertex-attributes-der-ikke-er-beregnet-direkte-på-netværksobjektet.">Tilføj vertex attributes der <em>ikke</em> er beregnet direkte på netværksobjektet.</h2>
<p>Som vi har talt om tidligere kan man ikke udenvidere tilføje vertex attributes fra sit datasæt (er de sorteret ens? er der lige mange rækker osv.?). Jeg har skrevet en lille funktion, som ligger i <code>networkfunctions.R</code> vi har sourcet, og derfor er i vores environment. Funktionen hedder: <code>add_vertex_attr(graph = ., data = ., match_var = .)</code>. Den skal have et grafobjekt (som vi gerne vil tilføje variable til), et datasæt (som vi gerne vil tilføje variable fra) og navnet på en match variabel som skal være i datasættet og skal svare til <code>name</code> grafobjektet.</p>
<div class="grid">
<div class="g-col-6">
<p>for virksomhedsgrafen kommer <code>V(.)$name</code> jo fra <code>affiliation</code> variablen, så den er <code>match_var</code> her. Lad os sige jeg gerne vil tilføje, country, sector, revenue, assets, employees, global ultimate owner (name + country), domestic ultimate owner (name + country) til det fulde netværk og til mine to komponenter</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>net_virk <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph =</span> net_virk, </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">select</span>(affiliation, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                                   affiliation_country, </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                                   sector, </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                                   revenue,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                                   total_assets, </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                                   n_employees, </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                                   guo_name, </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                                   guo_country, </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                                   duo_name,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                                   duo_country),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">match_var =</span> <span class="st">"affiliation"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>comp1_virk <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph =</span> comp1_virk, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">select</span>(affiliation, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                                   affiliation_country, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                                   sector, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                                   revenue,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                                   total_assets, </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                                   n_employees, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                                   guo_name, </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                                   guo_country, </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                                   duo_name,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                                   duo_country),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">match_var =</span> <span class="st">"affiliation"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>comp2_virk <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph =</span> comp2_virk, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">select</span>(affiliation, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                  affiliation_country, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                                  sector, </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                                  revenue,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                                  total_assets, </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                                  n_employees, </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                                  guo_name, </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                                  guo_country, </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                                  duo_name,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                                  duo_country),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">match_var =</span> <span class="st">"affiliation"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div class="g-col-6">
<p>for individgrafen kommer <code>V(.)$name</code> jo fra <code>name</code> variablen, så den er <code>match_var</code> her. Lad os sige jeg gerne vil tilføje køn og geografi for individerne:<br>
<br>
<br>
<br>
<br>
</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>net_ind <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph =</span> net_ind, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">select</span>(name, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                                  person_gender, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                                  person_geo),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">match_var =</span> <span class="st">"name"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br>
<br>
<br>
<br>
<br>
</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>comp1_ind <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph =</span> comp1_ind, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">select</span>(name, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                                  person_gender, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                                  person_geo),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">match_var =</span> <span class="st">"name"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><br>
<br>
<br>
<br>
<br>
<br>
</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>comp2_ind <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph =</span> comp2_ind, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> pharma_nordic <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">select</span>(name, </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                                      person_gender, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                                      person_geo),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">match_var =</span> <span class="st">"name"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="første-graf-plot" class="level2">
<h2 class="anchored" data-anchor-id="første-graf-plot">Første graf plot</h2>
<p>Her fra kører jeg videre med virksomhedsnetværket som eksempel..:</p>
<p>Lad os plotte hele netværket og den største komponent:</p>
<p>Først laver vi et plot af hele netværket (<code>net_virk</code>) og gemmer (<code>&lt;-</code>) det i <code>p</code>, og et af den største komponent (<code>comp1_virk</code>) og gemmer (<code>&lt;-</code>) det i <code>p1</code>. Når <code>patchwork</code> pakken er indlæst kan man ‘sætte’ plots sammen med <code>+</code> hvis de skal være ved siden af hinanden eller <code>/</code> hvis de skal være over hinanden:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> net_virk <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>(<span class="st">"fr"</span>) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Netværket i den skandinaviske </span><span class="sc">\n</span><span class="st">pharmasektor (n="</span>, <span class="fu">vcount</span>(net_virk), <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> comp1_virk <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>(<span class="st">"fr"</span>) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> affiliation_country), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">"Største komponent (n="</span>, <span class="fu">vcount</span>(comp1_virk), <span class="st">")"</span>)) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="st">"Country"</span>)) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> p1 </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session5_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="netværksmål" class="level1">
<h1>Netværksmål</h1>
<p>Som et led i analysen af vores netværk kan vi beregne nogle af de netværksmål på graf-niveau (altså hele netværket) vi har kigget på tidligere:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dens     <span class="ot">&lt;-</span> <span class="fu">edge_density</span>(comp1_virk)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>trans    <span class="ot">&lt;-</span> <span class="fu">transitivity</span>(comp1_virk)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>radius   <span class="ot">&lt;-</span> <span class="fu">radius</span>(comp1_virk)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>diameter <span class="ot">&lt;-</span> <span class="fu">diameter</span>(comp1_virk)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Lad os gemme dem i en med navne i en vector (en <code>named vector</code>). Det gør vi ved at skrive “det navn værdien skal have” = værdien. Sådan en named vector kan laves om til en <code>tibble</code> (dataformat) med <code>enframe</code>, så navne kommer i en kolonne og værdierne i en anden:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>net_description <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"nb. of nodes"</span> <span class="ot">=</span> <span class="fu">vcount</span>(net_virk),</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"nb. of edges"</span> <span class="ot">=</span> <span class="fu">ecount</span>(net_virk),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"nb. of components"</span> <span class="ot">=</span> <span class="fu">count_components</span>(net_virk),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: nb. of nodes"</span> <span class="ot">=</span> <span class="fu">vcount</span>(comp1_virk), </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: share of nodes"</span> <span class="ot">=</span> <span class="fu">vcount</span>(comp1_virk) <span class="sc">/</span> <span class="fu">vcount</span>(net_virk), </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: nb. of edges"</span> <span class="ot">=</span> <span class="fu">ecount</span>(comp1_virk), </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: share of edges"</span> <span class="ot">=</span> <span class="fu">ecount</span>(comp1_virk) <span class="sc">/</span> <span class="fu">ecount</span>(net_virk),  </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: diameter"</span> <span class="ot">=</span> diameter,  </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: radius"</span> <span class="ot">=</span> radius,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: density"</span> <span class="ot">=</span> dens, </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"largest component: transitivity"</span> <span class="ot">=</span> trans) <span class="sc">%&gt;%</span> <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"Measures"</span>, <span class="at">value =</span> <span class="st">"value"</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(net_description)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  Measures                            value
  &lt;chr&gt;                               &lt;dbl&gt;
1 nb. of nodes                      596    
2 nb. of edges                      266    
3 nb. of components                 405    
4 largest component: nb. of nodes    63    
5 largest component: share of nodes   0.106
6 largest component: nb. of edges    98    </code></pre>
</div>
</div>
<p>Med <code>write_xlsx</code> kan vi gemme tabllen i en excel-fil så tallene er klar til at blive fortolket og brugt i analysen i en pæn tabel. Vi lægger filen i mappen <code>output</code> og kalder den noget, så vi kan finde den igen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(net_description, <span class="at">path =</span> <span class="st">"output/pharma_nordic_example_net_description.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="ego-netværk-og-lokalt-strategiske-netværkspositioner" class="level1">
<h1>Ego-netværk og lokalt strategiske netværkspositioner</h1>
<p>Vi har indtil nu (måske lige bortset fra degree centralitet) fokuseret på hele netværksstrukturen og på nodernes position i betragtning af hele netværket.</p>
<p>De mål og ideer vi skal se på ny handler i højere grad om de enkelte aktørers (fx. virksomheder eller individer) direkte netværksrolle. Altså hvilken rolle de spiller i de konkrete direkte relationer de indgår i.</p>
<section id="egonetværk-af-nabolag." class="level2">
<h2 class="anchored" data-anchor-id="egonetværk-af-nabolag.">Egonetværk af nabolag.</h2>
<p>I stedet for at se på noden fra netværkets perspektiv, kan vi så at sige vende kikkerten og studere netværket ud fra noden. Et <strong>ego netværk</strong> er den konfiguration, der udspændes af en enkelt nodes direkte forbindelser og disses relation til hinanden. Hvis vi yderligere tager forbindelsernes forbindelser i betragtning, siger vi at et er ego’s 2nd neigbourhood osv. osv.</p>
<p>Lad os tegne et egonetværk for en enkelt virksomhed. <code>make_ego_graph</code> gør netop dette. Men bemærk at den returnere en liste af netværk, fordi man kan give den flere <code>nodes =</code>, så den laver et ego netværk for hver. Hvis vi kun vælger én node, får vi stadig en liste. Derfor er vi nødt til at skrive <code>[[1]]</code> bagefter for at få element 1 ud af listen.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ego <span class="ot">&lt;-</span> <span class="fu">make_ego_graph</span>(comp1_virk, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">nodes =</span> <span class="st">"EXOCURE SWEDEN AB"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggraph</span>(ego) <span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>() <span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>(<span class="at">filter =</span> {name <span class="sc">==</span> <span class="st">"EXOCURE SWEDEN AB"</span>}, <span class="at">label =</span> name)) <span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using "stress" as default layout</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_node_label(aes(filter = {: Ignoring unknown parameters:
`label.size`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session5_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Lad os tage en virksomhed og udvide netværket til 2., 3. og 4. nabolag. På den måde får vi et billede af det større netværk, men set fra denne virksomheds perspektiv.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ego <span class="ot">&lt;-</span> <span class="st">"PILA PHARMA AB"</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hvad er et ego netværk</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">ego_neighborhoods</span>(comp1_virk, <span class="dv">4</span>, ego, <span class="at">labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> pl, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1st neighbourhood"</span>, <span class="st">"2nd neighbourhood"</span>, <span class="st">"3rd neighbourhood"</span>, <span class="st">"4th neighbourhood"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session5_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vi har talt om trekantslukninger (når A og B <em>og</em> B og C er venner, er der sandsynlighed for at A og C også med tiden bliver det) og om hvordan det skaber closure i et netværk og bidrager til lokal densitet og cohesion - som skaber grundlag for tillid, sammenhold, norm-konformitet osv. Social kapital som gruppe fænomen.</p>
<p>Lad os begynde med at se på hvordan lokal transitivitet ser ud. For hver node i vores netværk kan vi se hvor mange af dens forbindelser der er lukkede (to venner der også kender hinanden) og hvor mange der er åbne (åbne/lukkede kalder vi transitivitet). Lad os tage 12 tilfældige noder (<code>sample()</code> på 12 fra vertex navne) og sortere dem, så den med højest transitivitet kommer først. Bemærk at <code>transitivity()</code> returnerer <code>NaN</code> - not a number - når en node ikke er en del af nogen triplets (så er der hverken faktisk lukkede eller mulige lukkede trekanter at regne på). Hvis vi gerne vil sortere er vi nødt til at erstatte <code>NaN</code> med <code>NA</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>random_nodes <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>name, <span class="dv">12</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>random_nodes <span class="ot">&lt;-</span> <span class="fu">transitivity</span>(comp1_virk, <span class="at">type =</span> <span class="st">"local"</span>, <span class="at">vids =</span> random_nodes)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>random_nodes[<span class="fu">is.nan</span>(random_nodes)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>random_nodes <span class="ot">&lt;-</span> <span class="fu">sort</span>(random_nodes, <span class="at">decreasing =</span> T, <span class="at">na.last =</span> T)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>random_nodes <span class="ot">&lt;-</span> <span class="fu">names</span>(random_nodes)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">ego_net_plot</span>(<span class="at">graph =</span> comp1_virk, <span class="at">nodes =</span> random_nodes, <span class="at">mode =</span> <span class="st">"transitivity"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidygraph</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidygraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:igraph':

    groups</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> pl)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session5_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> p, <span class="at">filename =</span> <span class="st">"output/network closure.pdf"</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Med closure følger imidlertid også muligheden for det R. Burt kalder strukturelle huller mellem ellers tætforbundne grupper. Det giver plads til en særlig netværks rolle, nemlig den at have ikke-redundente forbindelser. Altså forbindelser der rækker ud over den lukkede og dermed tæt forbundne gruppe man er en del af - og dermed få adgang til ny viden fx. Social kapital som brobygning.</p>
</section>
</section>
<section id="constraint-eller-det-modsatte-brokerage" class="level1">
<h1>Constraint eller det modsatte: <em>brokerage</em></h1>
<p>Ronald Burt’s constraint index måler i hvor høj grad en nodes ‘venner’ (direkte forbindelser) også er forbundet til hinanden - danner en lukket gruppe. I en lukket gruppe er man begrænset (constrained) i forhold til adgangen til ‘ny viden’ (tænk ekkokammer) fordi alle ens kontakter også er forbundne. En node der har venner ‘uden for’ sin klike har derfor en lavere constraint og vil oftere være den, der bringer nye ideer/tanker/viden ind i sin klike. Med andre ord, jo mindre “constraint”, desto bedre kan en node fungere som en broker over strukturelle huller i netværket.</p>
<p>En kombination af tre ting påvirker en nodes (ego) constraint:</p>
<ol type="1">
<li>c-size: antallet af egos direkte forbindelser (degree)…
<ul>
<li>lav degree –&gt; højere constraint</li>
</ul></li>
<li>c-density: antallet af forbindelser mellem egos direkte forbindelser…
<ul>
<li>høj densitet –&gt; højere constraint</li>
</ul></li>
<li>c-hierarchy: hvordan er alter-forbindelserne struktureret?
<ul>
<li>alter forbindelser samlet omkring en alter (partner/skygge ego) –&gt; høj constraint</li>
</ul></li>
</ol>
<p>funktionen <code>constraint</code> i Igraph beregner Burt’s constraint, som er højere jo mere ‘constrained’ en node er. Dvs. lav constraint = høj brokerage.</p>
<p>Det vil vi ofte gerne ‘vende om’ så det bliver et mål for brokerage evne.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>constr <span class="ot">&lt;-</span> <span class="fu">constraint</span>(comp1_virk)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>brokerage <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> constr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="constraint-og-andre-centralitetsmål" class="level1">
<h1>Constraint og andre centralitetsmål</h1>
<p>Lad os beregne et par centralitetsmål, som vi tidligere har kigget på</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>deg     <span class="ot">&lt;-</span>  <span class="fu">degree</span>(comp1_virk)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>betw    <span class="ot">&lt;-</span>  <span class="fu">betweenness</span>(comp1_virk, <span class="at">normalized =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>close   <span class="ot">&lt;-</span>  <span class="fu">closeness</span>(comp1_virk, <span class="at">normalized =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>eig     <span class="ot">&lt;-</span>  <span class="fu">eigen_centrality</span>(comp1_virk, <span class="at">directed =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>vector</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>core    <span class="ot">&lt;-</span>  <span class="fu">coreness</span>(comp1_virk)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>local_transitivity <span class="ot">&lt;-</span> <span class="fu">transitivity</span>(comp1_virk, <span class="at">type =</span> <span class="st">"local"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>og et ‘nyt’, nemlig lokal betweenness. Hvor betweenness almindeligvis optæller parvis korteste stier mellem alle noder i hele netværket og dermed fortæller os hvor stor en anden af disse, der går gennem en given node, er lokal betweenness et mere, ja, lokalt mål. Her beregner vi ‘kun’ stier inden for et givet nabolag omkring en node. Fx. 2. nabolag. Hvor mange korteste stier i egos udvidede netværk, venner og venners venner, går gennem ego. <code>cutoff =</code> bestemmer hvor langt ud vi skal kigge.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>local_betw    <span class="ot">&lt;-</span>  <span class="fu">betweenness</span>(comp1_virk, <span class="at">cutoff =</span> <span class="dv">2</span>, <span class="at">normalized =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Lad os samle de nodespecifikke centralitetsmål for den største komponent og gemme dem i en xslx fil.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>cent_metrics <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name        =</span> <span class="fu">V</span>(comp1_virk)<span class="sc">$</span>name,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree      =</span> deg, </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">betweenness =</span> betw,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">local_betweenness =</span> local_betw,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">closeness   =</span> close,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">eigen       =</span> eig,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">constraint  =</span> constr,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">brokerage   =</span> <span class="dv">1</span><span class="sc">/</span> constr,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">coreness    =</span> core,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">local_trans =</span> local_transitivity)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>cent_metrics <span class="ot">&lt;-</span> cent_metrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">degree_rank      =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(degree)),</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">betw_rank        =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(betweenness)),</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">local_betw_rank  =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(local_betweenness)),</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">closeness_rank   =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(closeness)),</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">brokerage_rank   =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(brokerage)),</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">eigen_rank       =</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(eigen)),</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">local_trans_rank =</span> <span class="fu">dense_rank</span>(local_trans))</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="fu">write_xlsx</span>(cent_metrics, <span class="st">"output/pharma_nordic_example_centralitymetrics.xlsx"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Inden vi går videre til næste del af denne øvelse gemmer vi lige alle centralitetsmålene som vertex attributes i grafobjektet: Husk I kan bruge <code>add_vertex_attr()</code> funktionen til det.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>comp1_virk <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph=</span> comp1_virk, <span class="at">data =</span> cent_metrics, <span class="at">match_var =</span> <span class="st">"name"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>I det følgende trækker vi et par eksempler ud og ser hvordan det lokale netværk kan være en constraint eller omvendt åbne muligheder for brokerage:</p>
<p>Lad os udvælge nogle forskellige virksomheder fra brokerage fordelingen: nr 1, 5, 10, 15, 20, 30 fx</p>
<p>Det gør vi fra det dataobjekt med centralitetsmål vi lige har gemt. Først sorterer vi data (<code>arrange()</code>) efter brokerage, dernæst tager vi (<code>filter()</code>) nr. 1, 5, 10, 15, 20, 30 og sørger for at der kun er en række for hver (to individer kan godt have samme værdi og dermed samme rank) <code>distinct()</code>. Tilsidst i vores <code>%&gt;%</code>-række bruger vi funktionen <code>pull()</code> til at tage den variabel vi skal bruge.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>brokers <span class="ot">&lt;-</span> cent_metrics <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(brokerage_rank) <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(brokerage_rank <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(brokerage_rank, <span class="at">.keep_all =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(name)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>brokers</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ALZINOVA AB"                       "ANNEXIN PHARMACEUTICALS AB (PUBL)"
[3] "CCRM NORDIC AB (SVB)"              "ATROGI AB"                        
[5] "MENDUS AB"                         "PROMORE PHARMA AB"                </code></pre>
</div>
</div>
<p>nu har vi en vector kaldet brokers med navne på de virksomheder vi gerne vil kigge på.</p>
<p>Jeg har skrevet en plotfunktion <code>ego_net_plot()</code>, som vi har sourcet fra <code>networkfunctions.R</code>. Den returnerer et plot-array med de udvalgte brokeres ego-netværk og nogle værdier:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">ego_net_plot</span>(<span class="at">graph =</span> comp1_virk, <span class="at">nodes =</span> brokers, <span class="at">mode =</span> <span class="st">"constraint"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> pl, <span class="at">common.legend =</span> T, <span class="at">legend =</span> <span class="st">"none"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> p, <span class="at">filename =</span> <span class="st">"output/constraint_brokerage.pdf"</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">8</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="assortativity-assortative-mixing---homofili-i-netværk" class="level1">
<h1>Assortativity (assortative mixing) - Homofili i netværk</h1>
<p>Et sidste men relateret fænomen til social lukning er spørgsmålet om hvilke mekanismer, der skaber netværkslukning.</p>
<p>Det kan være interessant at vide om noder der er ens på forskellige egenskaber er forbundet med hinanden. For at svare på det spørgsmål kan man udregne det der kaldes et netværks assortativity koefficent, der som en korrelations koefficient kan antage værdier mellem -1 og 1. En høj assortativity koefficient betyder at ensartede noder (på den udvalgte egenskab) i højere grad er forbundne, mens en negativ koefficient (gående mod -1) betyder at der omvendt er tale at forskelligartede noder tendere mod at have forbindelser. En assortatity koefficient på 0 beskriver et netværk, hvor der ingen korrelation (hverken positiv eller negativ) er mellem en bestemt egenskab og tendensen til at danne forbindelser.</p>
<section id="assortativity-for-kontinuerte-variable" class="level2">
<h2 class="anchored" data-anchor-id="assortativity-for-kontinuerte-variable">Assortativity for kontinuerte variable</h2>
<p>Funktion <code>assortativity()</code> bruges til at beregne assortativity for kontinuerte variable:</p>
<p>Vi kan fx beregne assortativity for degree. Altså, tenderer velforbundne noder mod at være forbundne. “Populær tiltrækker populær”.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assortativity</span>(comp1_virk, <span class="at">values =</span> <span class="fu">degree</span>(comp1_virk))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01553398</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assortativity_degree</span>(comp1_virk)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01553398</code></pre>
</div>
</div>
<p>Det ser ikke umiddelbart sådan ud. Med en værdi på nærmest 0 ser det ikke ud til at degree tiltrækker degree mere end det ikke gør.</p>
<p>I mange tilfælde vil det være interessant at beregne assortativity på netværks-eksterne egenskaber. Vi kunne fx. tage antal ansatte, omsætning og assets: er store virksomheder tilbøjelige til at skabe forbindelser til andre store virksomheder:</p>
<p>først sætter vi lige missing (<code>NA</code>) til 0 på antal ansatte, omsætning og assets:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(comp1_virk)<span class="sc">$</span>n_employees[<span class="fu">is.na</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>n_employees)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(comp1_virk)<span class="sc">$</span>revenue[<span class="fu">is.na</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>revenue)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(comp1_virk)<span class="sc">$</span>total_assets[<span class="fu">is.na</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>total_assets)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assortativity</span>(comp1_virk, <span class="at">values =</span> <span class="fu">V</span>(comp1_virk)<span class="sc">$</span>n_employees)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01537136</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assortativity</span>(comp1_virk, <span class="at">values =</span> <span class="fu">V</span>(comp1_virk)<span class="sc">$</span>revenue)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01108428</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assortativity</span>(comp1_virk, <span class="at">values =</span> <span class="fu">V</span>(comp1_virk)<span class="sc">$</span>total_assets)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in assortativity_impl(graph, values, values.in, directed, normalized):
NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>Heller ikke den store ‘effekt’ her.</p>
</section>
<section id="assortativity-for-kategorielle-variable" class="level2">
<h2 class="anchored" data-anchor-id="assortativity-for-kategorielle-variable">Assortativity for kategorielle variable</h2>
<p>funktionen <code>assortativity_nominal()</code> bruges til at beregne netværksassortativity for kategorielle variable</p>
<p>Vi gemte fx virksomhedens nationalitet som en vertex attribute, lad os se om det betyder noget: Her skal man lige huske at variablen skal behandles som en factor for at funktionen virker.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assortativity_nominal</span>(comp1_virk, <span class="at">types =</span> <span class="fu">factor</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>affiliation_country))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3333333</code></pre>
</div>
</div>
<p>Ikke så overraskende er der en høj assortativity her. Hvis I scroller op, kan i måske huske at den største komponent i høj grad var en komponent af svenske virksomheder.</p>
<p>En anden kategoriel variable kunne være Global Ultimate Owner (guo): Selskaber der ikke er en del af en koncern har <code>NA</code> på guo_name variablen, der sætter vi virksomhedens eget navn ind i stedet:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(comp1_virk)<span class="sc">$</span>guo_name[<span class="fu">is.na</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>guo_name)] <span class="ot">&lt;-</span> <span class="fu">V</span>(comp1_virk)<span class="sc">$</span>name[<span class="fu">is.na</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>guo_name)]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assortativity_nominal</span>(comp1_virk, <span class="at">types =</span> <span class="fu">factor</span>(<span class="fu">V</span>(comp1_virk)<span class="sc">$</span>guo_name))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1660473</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>