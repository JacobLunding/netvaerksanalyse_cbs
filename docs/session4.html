<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Centralitetsanalyse – Virksomhedsstrategi i et netværksperspektiv</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-bd192f0b7177c10948837637c5954a59.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Virksomhedsstrategi i et netværksperspektiv</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Install_guide.html"> 
<span class="menu-text">Install and setup R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./intro.html"> 
<span class="menu-text">Intro til R og Tidyverse</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./kursusmateriale.html"> 
<span class="menu-text">Kursusmateriale</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#indlæs-data-og-lav-netværksobjekter" id="toc-indlæs-data-og-lav-netværksobjekter" class="nav-link active" data-scroll-target="#indlæs-data-og-lav-netværksobjekter">Indlæs data og lav netværksobjekter:</a></li>
  <li><a href="#stier-afstande-centralitetsanalyse-i-netværk" id="toc-stier-afstande-centralitetsanalyse-i-netværk" class="nav-link" data-scroll-target="#stier-afstande-centralitetsanalyse-i-netværk">Stier, afstande, centralitetsanalyse i netværk</a>
  <ul class="collapse">
  <li><a href="#afstande-kilometer-distinktion-eller-stilængder" id="toc-afstande-kilometer-distinktion-eller-stilængder" class="nav-link" data-scroll-target="#afstande-kilometer-distinktion-eller-stilængder">Afstande, kilometer, distinktion eller stilængder</a></li>
  <li><a href="#centralitet-generelt" id="toc-centralitet-generelt" class="nav-link" data-scroll-target="#centralitet-generelt">Centralitet generelt</a></li>
  </ul></li>
  <li><a href="#kontakt-baserede-centralitetsmål" id="toc-kontakt-baserede-centralitetsmål" class="nav-link" data-scroll-target="#kontakt-baserede-centralitetsmål">Kontakt baserede centralitetsmål:</a>
  <ul class="collapse">
  <li><a href="#degree-centralitet" id="toc-degree-centralitet" class="nav-link" data-scroll-target="#degree-centralitet">Degree centralitet:</a></li>
  <li><a href="#eigenvector-centrality" id="toc-eigenvector-centrality" class="nav-link" data-scroll-target="#eigenvector-centrality">Eigenvector centrality:</a></li>
  </ul></li>
  <li><a href="#centralitetsmål-baseret-på-indirekte-forbindelser-stier" id="toc-centralitetsmål-baseret-på-indirekte-forbindelser-stier" class="nav-link" data-scroll-target="#centralitetsmål-baseret-på-indirekte-forbindelser-stier">Centralitetsmål baseret på indirekte forbindelser (stier):</a>
  <ul class="collapse">
  <li><a href="#excentricitets-centralitet" id="toc-excentricitets-centralitet" class="nav-link" data-scroll-target="#excentricitets-centralitet">Excentricitets centralitet:</a></li>
  <li><a href="#closeness-centralitet" id="toc-closeness-centralitet" class="nav-link" data-scroll-target="#closeness-centralitet">Closeness centralitet:</a></li>
  <li><a href="#betweenness-centralitet" id="toc-betweenness-centralitet" class="nav-link" data-scroll-target="#betweenness-centralitet">Betweenness centralitet:</a></li>
  </ul></li>
  <li><a href="#opsummering" id="toc-opsummering" class="nav-link" data-scroll-target="#opsummering">Opsummering:</a>
  <ul class="collapse">
  <li><a href="#centralitetsrank" id="toc-centralitetsrank" class="nav-link" data-scroll-target="#centralitetsrank">Centralitetsrank</a></li>
  <li><a href="#måler-de-forskellige-centralitetsmål-i-realiteten-noget-forskelligt" id="toc-måler-de-forskellige-centralitetsmål-i-realiteten-noget-forskelligt" class="nav-link" data-scroll-target="#måler-de-forskellige-centralitetsmål-i-realiteten-noget-forskelligt">Måler de forskellige centralitetsmål i realiteten noget forskelligt?</a></li>
  </ul></li>
  <li><a href="#kerneperiferi-struktur" id="toc-kerneperiferi-struktur" class="nav-link" data-scroll-target="#kerneperiferi-struktur">Kerne/periferi struktur:</a>
  <ul class="collapse">
  <li><a href="#coreness-eller-k-core-decomposition" id="toc-coreness-eller-k-core-decomposition" class="nav-link" data-scroll-target="#coreness-eller-k-core-decomposition">Coreness eller K-core decomposition</a></li>
  </ul></li>
  <li><a href="#visualiernger-af-netværk" id="toc-visualiernger-af-netværk" class="nav-link" data-scroll-target="#visualiernger-af-netværk">Visualiernger af netværk</a>
  <ul class="collapse">
  <li><a href="#visualisering-af-eccentriciteten" id="toc-visualisering-af-eccentriciteten" class="nav-link" data-scroll-target="#visualisering-af-eccentriciteten">Visualisering af eccentriciteten</a></li>
  <li><a href="#visualisering-af-betweenness" id="toc-visualisering-af-betweenness" class="nav-link" data-scroll-target="#visualisering-af-betweenness">Visualisering af betweenness</a></li>
  <li><a href="#visualisering-af-closeness" id="toc-visualisering-af-closeness" class="nav-link" data-scroll-target="#visualisering-af-closeness">Visualisering af closeness</a></li>
  </ul></li>
  <li><a href="#centralisering" id="toc-centralisering" class="nav-link" data-scroll-target="#centralisering">Centralisering:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Centralitetsanalyse</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>I denne session skal vi se på hvad centralitet betyder i en netværkssammenhæng.</p>
<p>“in the thick of things”</p>
<p>Lad os installere en ny pakke, hvis ikke den allerede er installeret. Den skal vi bruge senere til at lave pæne opsætninger af vores visualiseringer. Det er <a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr-pakken</a>, som blandt andet gør det muligt at sætte plotssammen.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ggpubr")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Lad os dernæst indlæse de pakker vi skal bruge</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="indlæs-data-og-lav-netværksobjekter" class="level1">
<h1>Indlæs data og lav netværksobjekter:</h1>
<p>Næste skridt er en række gentagelser (<a href="session1.html">se Session1</a>), hvor vi indlæser og subsetter den17 datasættet.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>den <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/den17-no-nordic-letters.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset data til kun at indeholde rækker hvor sector == "Corporation"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>den_corp <span class="ot">&lt;-</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  den <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sector <span class="sc">==</span> <span class="st">"Corporations"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># subsetter videre data til kun at indeholde linkere, dvs. individer med mere end 1 bestyrelsespost</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>den_corp <span class="ot">&lt;-</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  den_corp <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_memberships =</span> <span class="fu">n_distinct</span>(affiliation)) </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>den_corp <span class="ot">&lt;-</span> den_corp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n_memberships <span class="sc">&gt;</span><span class="dv">1</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Igen laver vi en biadjacency matrice, <span class="math inline">\(B_(individ \times virksomhed)\)</span>, og udregner de to projektioner:</p>
<p><span class="math inline">\(A_(individ \times individ) = B \times B^T\)</span> og</p>
<p><span class="math inline">\(A_(organisation \times organisation) = B^T \times B\)</span>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>biadj    <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(den_corp, <span class="at">formula =</span> <span class="sc">~</span>name <span class="sc">+</span> affiliation, <span class="at">sparse =</span> T)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>adj_ind  <span class="ot">&lt;-</span> biadj <span class="sc">%*%</span> <span class="fu">t</span>(biadj)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>adj_virk <span class="ot">&lt;-</span> <span class="fu">t</span>(biadj) <span class="sc">%*%</span> biadj</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Og laver to grafobjekter vha. igraph <code>graph_from_adjaceny_matrix()</code>-funktion</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># individ netværket </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>gr_ind    <span class="ot">&lt;-</span> adj_ind <span class="sc">%&gt;%</span> <span class="fu">graph_from_adjacency_matrix</span>(<span class="at">mode =</span> <span class="st">"undirected"</span>, <span class="at">weighted =</span> <span class="cn">TRUE</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># virksomheds netværket </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>gr_virk   <span class="ot">&lt;-</span> adj_virk <span class="sc">%&gt;%</span> <span class="fu">graph_from_adjacency_matrix</span>(<span class="at">mode =</span> <span class="st">"undirected"</span>, <span class="at">weighted =</span> <span class="cn">TRUE</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>I det følgende ser vi nærmere på virksomhedsnetværket… (<code>gr_virk</code>). Lad os først lige se på netværkets komponent-struktur. Hvor mange komponenter består det af? Funktionen <code>components()</code> giver os en liste af resultater, der fortæller os 1) <code>$memberships</code>, dvs. hvilke virksomheder hører til hvilken komponent, 2) <code>$csize</code> hvor mange virksomheder er der i hver komponent og 3) <code>$no</code>, for mange komponenter er der i alt</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>complist <span class="ot">&lt;-</span> <span class="fu">components</span>(gr_virk)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>complist<span class="sc">$</span>csize</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 773   2   4   2   3   2   4   2   2   2   2   3   2   2   3   3   4   2   2
[20]   2   6   2   2   2   6   2   2   2   2   3   3   2   2   2   2   2   2   3
[39]   3   2   2   3   2   2   2   2   3   2   2   2   2   2   2   2   2   2   2
[58]   2</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>complist<span class="sc">$</span>no</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 58</code></pre>
</div>
</div>
<p>Husk fra sidst at funktionen <code>largest_component()</code> returnerer subgrafen for netværkets største komponent:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>largest_comp_virk <span class="ot">&lt;-</span> gr_virk <span class="sc">%&gt;%</span> <span class="fu">largest_component</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>I næste skridt gemmer vi to netværksvisualiseringer, én af hele netværket med alle komponenter (det plot kalder vi p1) og ét med netværket for den største komponent (det kalder vi p2):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> gr_virk <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'fr'</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">color=</span><span class="st">'black'</span>, <span class="at">alpha=</span><span class="fl">0.6</span>)  <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Netværket af virksomheder i </span><span class="sc">\n</span><span class="st">'Danish Elite Network' (n="</span>, <span class="fu">vcount</span>(gr_virk), <span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()  <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> largest_comp_virk <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'fr'</span>) <span class="sc">+</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">color=</span><span class="st">'black'</span>, <span class="at">alpha=</span><span class="fl">0.6</span>)  <span class="sc">+</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Den største komponent (n="</span>, <span class="fu">vcount</span>(largest_comp_virk),<span class="st">")"</span>)) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Og med <code>ggarrange()</code> funktionen fra <code>ggpubr</code> kan vi lave et fint sammensat plot med de to plots ved siden af hinanden:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(p1, p2))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="stier-afstande-centralitetsanalyse-i-netværk" class="level1">
<h1>Stier, afstande, centralitetsanalyse i netværk</h1>
<section id="afstande-kilometer-distinktion-eller-stilængder" class="level2">
<h2 class="anchored" data-anchor-id="afstande-kilometer-distinktion-eller-stilængder">Afstande, kilometer, distinktion eller stilængder</h2>
<p>Vi er vant til at tænke afstand på forskellige måder. Åbenlyst opmåler vi hele tiden den fysiske verden i meter og km, mv. Hvor langt er der på arbejder? I kender formentlig også til den franske sociolog Pierre Bourdieus repræsentation af samfundet som et to-dimensionelt rum. En slags formalisering af noget I også er vant til at tale om og føle, nemlig at vi i hverdagen oplever sociale afstande; direktøren vs professoren vs fabriksarbejderen osv. I netværk har vi også et begreb om afstande. Her tænker vi i stier. Afstanden fra en vertice i et netværk til en anden et det mindste antal af edges vi skal passere igennem for at komme fra den ene til den anden. Selvom netværksvisualiseringen (nedenfor til venstre) placerer A og B visuelt tæt på hinanden er netværksafstanden (den korteste sti) fra A til B seks, mens den korteste sti mellem A og C, der visuelt ligger længere fra hinanden er fem. Det er tre forskellige måder at tænke afstande på (omend de ofte er relateret - men det er en anden historie).</p>
<p><img src="images/dist.png" class="img-fluid"></p>
<p>I en forbundet graf (hvor der er en eller flere stier fra alle vertices til alle andre vertices) har alle vertices en defineret afstand til hinanden, nemlig den korteste sti (shortest path eller geodesic path). Når vi har et begreb om afstand i netværk (geodesic distance) kan vi begynder at måle forskellige ting, bl.a. centalitet.</p>
</section>
<section id="centralitet-generelt" class="level2">
<h2 class="anchored" data-anchor-id="centralitet-generelt">Centralitet generelt</h2>
<p>I det følgende skal kigge på en række forskellige måder at konceptualisere centralitet i netværk på. De bygger på forskellige ideer og intuitioner, men har det til fælles at det er måder at undersøge spørgsmålene: Hvem har strukturelt vigtige positioner i et netværk?</p>
<p>Linton C Freeman (1979) påpeger at det idealtypiske billede på centralitet er en såkaldt stjernegraf, hvor en node er forbundet til alle andre, der hver især kun er forbundet til denne:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>star <span class="ot">&lt;-</span> <span class="fu">make_star</span>(<span class="dv">10</span>, <span class="at">mode =</span> <span class="st">"undirected"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(star)<span class="sc">$</span>name <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>star <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>(<span class="st">"kk"</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> name, <span class="at">size =</span> <span class="fu">degree</span>(star)), <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Stjernegraf med 10 noder"</span>, <span class="at">caption =</span> <span class="st">"Freeman, Linton C. 1979. “Centrality  in Social Networks  Conceptual  Clarification.” Social  Networks 1979(1):215–39."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I denne situation er A den mest centrale node, fordi den har flest ‘kontakter’, 9 i alt, hvor de øvrige kun har 1. A’s centralitet kan også udtrykkes i termer af afstande, A er så at sige tættest på de andre node, da A i et led kan nå alle, mens alle andre har skal gå to led for at nå andre end A. Det betyder videre at A også er mest central i den forstand at al ‘kommunikation’ mellem de andre noder nødvendigvis må gå gennem A. Med andre ord: A er den mest populære i ‘klassen’, A har også lettest ved at sprede et budskab (et rygte måske? eller en virus?) og A har også lettest adgang til viden (sladder måske?) da en information for at komme fra B til nogen anden aktør må gå gennem A.</p>
</section>
</section>
<section id="kontakt-baserede-centralitetsmål" class="level1">
<h1>Kontakt baserede centralitetsmål:</h1>
<p>En måde at tænke centralitet på er som nævnt kontakter. Antallet af noder en given node er direkte forbundet til kaldes i grafteori, nodens <strong>degree</strong>. Det kan også beskrives som et lokalt centralitetsmål.</p>
<section id="degree-centralitet" class="level2">
<h2 class="anchored" data-anchor-id="degree-centralitet">Degree centralitet:</h2>
<p><strong>Ide</strong>: centralitet kommer til udtryk i høj “aktivitet”, en central aktør er en aktør med mange direkte kontakter.</p>
<p><strong>Praksis</strong>: Tæller hvor mange direkte forbindelser hver node har, dvs hvor mange andre noder den er forbundet til.</p>
<ul>
<li><p>I et ikke-retningsbestemte netværk (undirected) der kun et degree mål.</p></li>
<li><p>I retningsbestemte netværk har hver node en:</p>
<ul>
<li><p>‘out degree’ (udadgående forbindelser)</p></li>
<li><p>‘in degree’ (indkommende forbindelser)</p></li>
<li><p>Total degree (summen af de to).</p></li>
</ul></li>
</ul>
<p>Lad os udregne degree (med <code>degree()</code> funktionen fra <code>igraph</code>) for noderne i den største komponent:</p>
<p><strong>Beslutning</strong>: Hvis netværket er <em>retningsbestemt</em> skal det defineres i funktionen om det er in, out eller total degree vi vil udregne (fx <code>degree(...mode = "in")</code> eller <code>degree(...mode = "out"</code> etc.))</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>deg <span class="ot">&lt;-</span> <span class="fu">degree</span>(largest_comp_virk) </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(deg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>deg
  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 
105 100  90  77  54  47  40  35  35  21  17  26  16  17  24  16  13   9   5   7 
 21  23  24  25  26  28  30 
  5   1   3   3   4   2   1 </code></pre>
</div>
</div>
<p>fordi degree er udregnet på grafobjektet (og derfor er sorteret på samme måde), kan vi uden problemer tilføje vores degree variable som en ny vertex attribute. Det kan vi gøre på to måder: 1) med <code>V(netværksobjekt)$"nyt attribute" &lt;- degree</code> 2) med en funktion <code>set_vertex_attr()</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(largest_comp_virk)<span class="sc">$</span>degree <span class="ot">&lt;-</span> deg</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#2)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>largest_comp_virk <span class="ot">&lt;-</span> <span class="fu">set_vertex_attr</span>(largest_comp_virk, <span class="at">name =</span> <span class="st">"degree"</span>, <span class="at">value =</span> deg)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Lad os undersøge hvordan degree fordelingen ser ud (<code>med et histogram</code>) og hvordan degree fordelingen beskriver netværket (<code>med et grafplot</code>):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>hist_deg <span class="ot">&lt;-</span> deg <span class="sc">%&gt;%</span> <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>.), <span class="at">fill =</span> <span class="st">"grey20"</span>) <span class="sc">+</span> <span class="co">#binwidth definerer, hvor mange kategorier på x-aksen en søje i histogrammet skal 'opsummere'</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">name =</span> <span class="st">"Antal"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">5</span>,<span class="fu">max</span>(deg), <span class="dv">5</span>)), <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(deg), <span class="dv">1</span>), <span class="at">name =</span><span class="st">"Degree"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>p_deg <span class="ot">&lt;-</span> largest_comp_virk <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>degree), <span class="at">alpha=</span><span class="fl">0.8</span>)  <span class="sc">+</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Den største komponent (n="</span>, <span class="fu">vcount</span>(largest_comp_virk),<span class="st">")"</span>), <span class="at">subtitle =</span> <span class="st">"degree"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(hist_deg, p_deg), <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">1.4</span>,<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="eigenvector-centrality" class="level2">
<h2 class="anchored" data-anchor-id="eigenvector-centrality">Eigenvector centrality:</h2>
<p><strong>Ide</strong>: som med degree, det er godt at have mange ‘venner’, men det er endnu bedre, hvis disse venner også er populære!</p>
<p><strong>Praksis</strong>: Udregnes hurtigt med ‘kompliceret’ matematik, eigenvector decomposition, deraf navnet. Intuitionen i målet er: Alle noder starter med en ‘vægt’ på 1, for hver node tælles summen af deres forbindelsers ‘vægt’, svarer i første omgang til degree, gentages i flere runder, hvorved noder der er forbundne til velforbundne node, stiger hurtigere (= er mere centrale), skaleres til at være mellem 0 og 1, hvor 0 er isolates og 1, den mest centrale.</p>
<p><strong>Beslutninger</strong>: <strong>1)</strong> skal edgevægte betyder noget? Hvis vi ikke skriver noget tager den edgeweights med, hvis der er nogen, hvis vi skriver <code>weights = NA</code> tager udregningen ikke hensyn til edgeweights, dvs. alle forbindelser har samme vægt (w=1). <strong>2)</strong> er netværket retningsbestemt?</p>
<p><strong>Problemer</strong>: Værk opmærksom. Hvis vi har et netværk med en meget ‘skæv’ fordeling af degree, vil der ske det at få meget velforbundne noder, ‘hubs’, vil ‘skabe’ en lokaliseringseffekt på eigevector centralitetn, således at den mest indfanger forskellen på dette hub og resten af netværket. Fordi eigencentraliteten udregnes i skridt, hvor en nodes centralitet afhænger af dens ‘naboer’ centralitet. I næste runde vil en nodes egen centralitet så at sige blive reflekteret tilbage i kraft af dens naboer (som jo nu har ‘lånt’ dennes osv.) - et feedback loop, der kan skabe en situation hvor al centralitet samles omkring et hub og centraliteten for resten af netværket går mod 0. Er det en korrekt beskrivelse af centraliteten af forskellige aktører?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>eig <span class="ot">&lt;-</span> <span class="fu">eigen_centrality</span>(largest_comp_virk, <span class="at">weights =</span> <span class="cn">NA</span>, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(eig)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ vector : Named num [1:773] 0.00272 0.00445 0.0023 0.012 0.48501 ...
  ..- attr(*, "names")= chr [1:773] "3C Groups" "3xN" "5E Byg (Bestyrelse)" "7N" ...
 $ value  : num 14.8
 $ options:List of 20
  ..$ bmat   : chr "I"
  ..$ n      : int 773
  ..$ which  : chr "LA"
  ..$ nev    : int 1
  ..$ tol    : num 0
  ..$ ncv    : int 0
  ..$ ldv    : int 0
  ..$ ishift : int 1
  ..$ maxiter: int 3000
  ..$ nb     : int 1
  ..$ mode   : int 1
  ..$ start  : int 1
  ..$ sigma  : num 0
  ..$ sigmai : num 0
  ..$ info   : int 0
  ..$ iter   : int 4
  ..$ nconv  : int 1
  ..$ numop  : int 50
  ..$ numopb : int 0
  ..$ numreo : int 40</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>eig <span class="ot">&lt;-</span> eig<span class="sc">$</span>vector</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>lad os igen gemme eigencentraliteten som en vertex attribute</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(largest_comp_virk)<span class="sc">$</span>eigencentrality <span class="ot">&lt;-</span> eig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>og plotte fordelingen og netværket</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hist_eig <span class="ot">&lt;-</span> eig <span class="sc">%&gt;%</span> <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>.), <span class="at">fill =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Antal"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(eig), .<span class="dv">1</span>), <span class="at">name =</span><span class="st">"Eigencentralitet"</span>) <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>p_eig <span class="ot">&lt;-</span> largest_comp_virk <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>eigencentrality), <span class="at">alpha=</span><span class="fl">0.8</span>)  <span class="sc">+</span> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Den største komponent (n="</span>, <span class="fu">vcount</span>(largest_comp_virk),<span class="st">")"</span>), <span class="at">subtitle =</span> <span class="st">"Eigencentrality"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(hist_eig, p_eig), <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">1.4</span>,<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="centralitetsmål-baseret-på-indirekte-forbindelser-stier" class="level1">
<h1>Centralitetsmål baseret på indirekte forbindelser (stier):</h1>
<p>En anden gruppe af centralitetsmål er mere fokuseret på den strukturelle position i hele netværket og bygger på en antagelse om at selvom den enkelte aktør ikke ‘kender’ sine indirekte forbindelser, har positionen i netværkets globale strutkru stadig betydning for adgangen til fx information eller indflydelse osv. Det vi kigger på med disse mål er ikke længere direkte forbindelser, men afstande mellem aktører målt som korteste stier (minimum antal edges der skal passerer for at komme fra A til B).</p>
<p><strong>Beslutninger:</strong> 1) skal stilængderne i netværket vægtes i udregningen (i kraft af edge weights), hvis vi ikke skriver noget influerer evt. edge-weights på stilængderne (hvis der er en weight attribute i grafobjektet), skriver vi <code>weights = NA</code> ignoreres edge weights så alle edges har samme vægt (w = 1)</p>
<section id="excentricitets-centralitet" class="level2">
<h2 class="anchored" data-anchor-id="excentricitets-centralitet">Excentricitets centralitet:</h2>
<p><strong>Ide</strong>: Et netværk har yderpunkter, dvs. noder der er længst fra hinanden. De siges at ligge i periferien og deres afstand er derfor netværkets <strong>diameter</strong>. Den/de noder der har den <em>korteste</em> afstand deres <em>fjerneste</em> node, kalder vi <strong>centrum</strong> i netværket, og afstanden til periferien, <strong>radius</strong>.</p>
<p><strong>Praksis</strong>: En nodes eccentricitet er deres maksimale afstand (korteste sti) til en anden node.</p>
<p><img src="images/eccentricity.png" class="img-fluid"></p>
<p>Det er almindeligt at bruge den inverse eccentricitet (dvs <span class="math inline">\(1 \over eccentricity\)</span>) som centralitetsmål, så perifære noder får et lavere tal og centrale noder et højre.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ecc <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">eccentricity</span>(largest_comp_virk, <span class="at">weights =</span> <span class="cn">NA</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>lad os igen gemme eccentricity centraliteten som en vertex attribute i vores grafobjekt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(largest_comp_virk)<span class="sc">$</span>eccentricity <span class="ot">&lt;-</span> ecc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>og kigge på fordelingen og netværket</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>hist_ecc <span class="ot">&lt;-</span> ecc <span class="sc">%&gt;%</span> <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>.), <span class="at">fill =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Antal"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(ecc), .<span class="dv">01</span>), <span class="at">name =</span><span class="st">"1/Eccentricity"</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>p_ecc <span class="ot">&lt;-</span> largest_comp_virk <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>eccentricity), <span class="at">alpha=</span><span class="fl">0.8</span>)  <span class="sc">+</span> </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Den største komponent (n="</span>, <span class="fu">vcount</span>(largest_comp_virk),<span class="st">")"</span>), <span class="at">subtitle =</span> <span class="st">"1/Eccentricity"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(hist_ecc, p_ecc), <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">1.4</span>,<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="closeness-centralitet" class="level2">
<h2 class="anchored" data-anchor-id="closeness-centralitet">Closeness centralitet:</h2>
<p>Ide: en central netværks-aktør er en der (i gennemsnit) er tæt på de andre i netværket. En der hurtigt kan række ud i netværket og derfor har en grad af <em>uafhængighed</em>. Hvor eccentricitet måler hvor langt der er til den fjerneste nabo, måler closeness i stedet hvor langt der i gennemsnit er til alle naboer.</p>
<p>I praksis: udregnes (for node A) som: summen af A’s netværksafstand (shortest path) til alle andre noder / antallet af noder (udover A selv). Det svarer til den gennemsnitlige afstand til netværkets andre aktører. Almindeligvis bruges den inverse gennemsnitsafstand som centralitetsmål (det er også det mål <code>igraph</code> producerer), så et lavt tal betyder lav centralitet og et højt tal en ‘højere’ centralitet.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>clo  <span class="ot">&lt;-</span> <span class="fu">closeness</span>(largest_comp_virk, <span class="at">weights =</span> <span class="cn">NA</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Igen, lad os gemme closeness centraliteten i vores grafobjekt som en vertex attribute:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(largest_comp_virk)<span class="sc">$</span>closeness <span class="ot">&lt;-</span> clo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>og producere det samme overblik over fordelingen og netværket:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>hist_clo <span class="ot">&lt;-</span> clo <span class="sc">%&gt;%</span> <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>.), <span class="at">fill =</span> <span class="st">"grey20"</span>) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Antal"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">name =</span><span class="st">"Closeness"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>p_clo <span class="ot">&lt;-</span> largest_comp_virk <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>closeness), <span class="at">alpha=</span><span class="fl">0.8</span>)  <span class="sc">+</span> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Den største komponent (n="</span>, <span class="fu">vcount</span>(largest_comp_virk),<span class="st">")"</span>), <span class="at">subtitle =</span> <span class="st">"Closeness"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(hist_clo, p_clo), <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">1.4</span>,<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="betweenness-centralitet" class="level2">
<h2 class="anchored" data-anchor-id="betweenness-centralitet">Betweenness centralitet:</h2>
<p>Hvis vi i stedet for at kigge på afstanden til alle andre, kigger på hvor hyppigt en aktør ligger på den korteste sti mellem andre noder, så får vi et bud på hvor nødvig en given aktør er for at ‘noget’ (kommunikation/sladder/viden etc.) kan flyde mellem de andre aktører</p>
<p>Ide: En central node er en der er uundværlig for at andre noder, der ikke er direkte forbundne, kan ‘nå’ hinanden, dvs. én der bygger bro, én gatekeeper osv.</p>
<p>I praksis (for en given node, A): tæller antallet af korteste stier, parvist, mellem alle andre noder, der går igennem A.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bet <span class="ot">&lt;-</span> <span class="fu">betweenness</span>(largest_comp_virk, <span class="at">weights =</span> <span class="cn">NA</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(largest_comp_virk)<span class="sc">$</span>betweenness <span class="ot">&lt;-</span> bet</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>hist_bet <span class="ot">&lt;-</span> bet <span class="sc">%&gt;%</span> <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>.), <span class="at">fill =</span> <span class="st">"grey20"</span>) <span class="sc">+</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Antal"</span>) <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">name =</span><span class="st">"Betweenness"</span>) <span class="sc">+</span> <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>p_bet <span class="ot">&lt;-</span> largest_comp_virk <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.45</span>) <span class="sc">+</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>betweenness), <span class="at">alpha=</span><span class="fl">0.8</span>)  <span class="sc">+</span> </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Den største komponent (n="</span>, <span class="fu">vcount</span>(largest_comp_virk),<span class="st">")"</span>), <span class="at">subtitle =</span> <span class="st">"Betweenness"</span>, <span class="at">color =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>), <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(hist_bet, p_bet), <span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">1.4</span>,<span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="opsummering" class="level1">
<h1>Opsummering:</h1>
<p>Nu har vi set på en række forskellige centralitetsmål, der teoretisk/konceptuelt indfanger forskellige aspekter af, hvad det vil sige at være centralt placeret i en netværks struktur:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Centralitetsmål</th>
<th><code>Igraph()</code></th>
<th>edge vægte?</th>
<th>retningsbestemt?</th>
<th>normalisering?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>degree centralitet</td>
<td><code>degree()</code></td>
<td></td>
<td>hvis ja: <code>mode ="in"</code>, <code>"out"</code> eller <code>"all"</code></td>
<td><code>normalized = TRUE</code> eller <code>FALSE</code></td>
</tr>
<tr class="even">
<td>eigenvector centralitet</td>
<td><code>eigen_centrality()</code></td>
<td><code>weights = NA</code> ignorerer vægte</td>
<td><code>directed = TRUE</code> eller <code>FALSE</code></td>
<td>altid normaliseret</td>
</tr>
<tr class="odd">
<td>eccentricity centralitet</td>
<td>1 / <code>eccentricity()</code></td>
<td><code>weights = NA</code> ignorerer vægte</td>
<td>hvis ja: <code>mode ="in"</code>, <code>"out"</code> eller <code>"all"</code></td>
<td><code>normalized = TRUE</code> eller <code>FALSE</code></td>
</tr>
<tr class="even">
<td>closeness centralitet</td>
<td><code>closeness()</code></td>
<td><code>weights = NA</code> ignorerer vægte</td>
<td>hvis ja: <code>mode ="in"</code>, <code>"out"</code> eller <code>"all"</code></td>
<td><code>normalized = TRUE</code> eller <code>FALSE</code></td>
</tr>
<tr class="odd">
<td>betweenness centralitet</td>
<td><code>betweenness()</code></td>
<td><code>weights = NA</code> ignorerer vægte</td>
<td><code>directed = TRUE</code> eller <code>FALSE</code></td>
<td><code>normalized = TRUE</code> eller <code>FALSE</code></td>
</tr>
</tbody>
</table>
<p>Lad os samle alle centralitetsmålene, som nu ligger som vertex attributes i vores grafobjekt, i en data.frame med <code>igraph</code>-funktionen <code>as_data_frame()</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cent_metrics <span class="ot">&lt;-</span> <span class="fu">as_data_frame</span>(largest_comp_virk, <span class="at">what =</span> <span class="st">"vertices"</span>) <span class="sc">%&gt;%</span> <span class="fu">tibble</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="centralitetsrank" class="level2">
<h2 class="anchored" data-anchor-id="centralitetsrank">Centralitetsrank</h2>
<p>Det kan være en god ide at lave en rankvariabel for de forskellige mål, som ranker alle noder efter deres centralitet på de forskellige mål. Funktionen <code>dense_rank()</code> kombineret med <code>desc()</code> (descending) giver os et rank hvor noden med den højeste centralitet bliver nr 1 og de andre noder, 2,3,4,5 osv. jo lavere deres centralitet er. Det gør det lidt lettere at overskue, hvor en bestemt node er placeret på de forskellige centralitetsmål.</p>
<p>Når vi skriver i stedet for at skrive koden for hver eneste centralitets mål kan vi bruge funktionen <code>across()</code> inde i <code>mutate()</code> det betyder at vi i denne sammen hæng gør ‘noget’ henover alle kolonner undtagen name <code>.cols = -name</code>, det vi gør er en funktion <code>.fns =</code> som er (<code>~</code> betyder her funktion) <code>dense_rank(desc(.x))</code> (hvor <code>.x</code> betyder elmeneterne i <code>.cols</code>, altså for hver af kolonnerne der ikke er name), det sidste udtryk vi skriver i across funktionen er hvad der skal ske med variablene. Hvis vi ikke skriver noget her, overskriver vi de gamle variable. Hvis vi som nedenfor skriver <code>.names = "{.col}_rnk"</code> betyder det at vi laver nye variable der kommer til at hedde det samme som de gamle <code>"{.col}"</code> + _rnk. Dvs. rangeringen af degree bliver til ny variabel degree_rnk.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>cent_metrics_rnk <span class="ot">&lt;-</span> cent_metrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">-</span>name, <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">dense_rank</span>(<span class="fu">desc</span>(.x)), <span class="at">.names =</span> <span class="st">"{.col}_rnk"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="måler-de-forskellige-centralitetsmål-i-realiteten-noget-forskelligt" class="level2">
<h2 class="anchored" data-anchor-id="måler-de-forskellige-centralitetsmål-i-realiteten-noget-forskelligt">Måler de forskellige centralitetsmål i realiteten noget forskelligt?</h2>
<p>Jeg har skrevet en plot-funktion der ligger i <code>networkfunctions.R</code> som kan downloads her:</p>
<p><a href="functions/networkfunctions.R" class="btn btn-primary">Download functions</a></p>
<p>eller hentes på kursets hjemmeside.</p>
<p>Hvis I lægger den i functionsmappen i rprojekt-mappen, kan i source den som med andre scripts:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"functions/networkfunctions.R"</span>, <span class="at">echo =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>med <code>cor_plots()</code> funktionen kan vi lave et hurtigt plot, der viser korrelationen mellem de f orskellige centralitetsmål:</p>
<p>Vi kan lige normalisere alle målene, så de går fra 0 til 1 det gør vi ved at dividere alle med max (for dem der allerede er normaliseret betyder det ingen ting da x/1 jo er x). Undtagen selvfølgelig name variablen (så den skipper vi i across funktionen <code>across(.cols = -name, ...)</code>)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cent_metrics_norm <span class="ot">&lt;-</span> cent_metrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">-</span>name, <span class="at">.fns =</span> <span class="sc">~</span>.x <span class="sc">/</span> <span class="fu">max</span>(.x))) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>I <code>cor_plots()</code> skal I huske at skrive hvilken variabel i jeres dataobjekt, der er en navne-variabel (som default leder den efter “name” eller “affiliation”). Der er også mulighed for at sætte en <code>plot.title</code>, (default er “Korrelationer mellem centralitetsmål”) og en <code>title.size</code> (default er 12):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cent_metrics_norm <span class="sc">%&gt;%</span> <span class="fu">cor_plots</span>(., <span class="at">name_var =</span> <span class="st">"name"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>og vi kan se de parvise correlationer mellem målenen (vi ‘smider’ igen name-variablen ud <code>select(-name)</code>)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cent_metrics_norm  <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> <span class="fu">cor</span>(, <span class="at">method =</span> <span class="st">"kendall"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   degree eigencentrality eccentricity closeness betweenness
degree          1.0000000       0.5928230    0.4545670 0.6668908   0.6239287
eigencentrality 0.5928230       1.0000000    0.3014156 0.7061785   0.3941629
eccentricity    0.4545670       0.3014156    1.0000000 0.5468315   0.4254326
closeness       0.6668908       0.7061785    0.5468315 1.0000000   0.5194376
betweenness     0.6239287       0.3941629    0.4254326 0.5194376   1.0000000</code></pre>
</div>
</div>
<p>Konklussion: De er allesammen korrelerede til hinanden i forskellige grad, men slet ikke perfekt, da de udtrykker forskellige aspekter af hvad det vil sige at være central i et netværk:</p>
<p><img src="images/centralities.png" class="img-fluid"> Fig fra: fra: Ortiz-Arroyo, Daniel. 2010. “Discovering Sets of Key Players in Social Networks.” pp.&nbsp;27–47 in Computational Social Network Analysis, Computer Communications and Networks, edited by A. Abraham, A.-E. Hassanien, and V. Snásel. London: Springer London.</p>
<p>Degree: ‘simpel’ popularitet, dvs. hvem har flest forbindelser. Closeness: effektiv spreder af information, da høj closeness betyder at resten af netværket er relativt tilgængeligt for denne node. Betweennes: kontrol med information, høj betweenness betyder at en stor del af det, der ‘flyder’ mellem noder i netværket går gennem denne node.</p>
<p>Jo mere et netværk ‘ligner’ en stjernegraf eller dvs. jo mere kerne-periferi agtig netværksstrukturen er desto mere vil de forskellige centralitetsmål korrelere. Fordi de måler den samme underliggende kerneperiferistruktur.</p>
</section>
</section>
<section id="kerneperiferi-struktur" class="level1">
<h1>Kerne/periferi struktur:</h1>
<section id="coreness-eller-k-core-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="coreness-eller-k-core-decomposition">Coreness eller K-core decomposition</h2>
<p>En anden måde at tænke centralitet på, med udgangspunkt i netværkets kerne/periferi struktur</p>
<p><strong>ide</strong>: Første lag K=0: Alle noder; Andet lag K=1 alle noder med &lt; 1 forbindelse slettes; næste lag K=2 alle noder der nu har &lt;2 forbindelser slettes; K=3 alle noder der nu har &lt;3 forbindelser slettes osv. indtil man ikke kan slette noder uden at antallet af de reterende noders forbindelser falder….</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>core <span class="ot">&lt;-</span> <span class="fu">coreness</span>(largest_comp_virk) </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(core)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>core
  1   2   3   4   5   6   7   8   9  11 
124 122 126  97  81  71  53  27  57  15 </code></pre>
</div>
</div>
<p>Lad os prøve at visualisere logikken med en funktion fra <code>networkfunctions.R</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coreness_viz</span>(largest_comp_virk, <span class="at">algorithm =</span> <span class="st">'kk'</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>lad os lige tilføje coreness til vores cent_metrics data og til grafobjektet</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>cent_metrics <span class="ot">&lt;-</span> cent_metrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">coreness =</span> core)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(largest_comp_virk)<span class="sc">$</span>coreness <span class="ot">&lt;-</span> core</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="visualiernger-af-netværk" class="level1">
<h1>Visualiernger af netværk</h1>
<section id="visualisering-af-eccentriciteten" class="level2">
<h2 class="anchored" data-anchor-id="visualisering-af-eccentriciteten">Visualisering af eccentriciteten</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>largest_comp_virk <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>eccentricity, <span class="at">size =</span> eccentricity, <span class="at">alpha =</span> eccentricity), <span class="at">show.legend =</span> F) <span class="sc">+</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">scale_color_viridis</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"1/Eccentricity"</span>) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>( <span class="at">filter=</span>name <span class="sc">%in%</span> {cent_metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(eccentricity <span class="sc">%in%</span> <span class="fu">c</span>(<span class="fu">min</span>(eccentricity), <span class="fu">max</span>(eccentricity))) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(name)}, <span class="at">label=</span>name), <span class="at">alpha=</span><span class="fl">0.65</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">repel=</span>T, <span class="at">force =</span> <span class="dv">10</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualisering-af-betweenness" class="level2">
<h2 class="anchored" data-anchor-id="visualisering-af-betweenness">Visualisering af betweenness</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>largest_comp_virk <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.35</span>) <span class="sc">+</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>betweenness, <span class="at">size =</span> betweenness, <span class="at">alpha =</span> betweenness), <span class="at">show.legend =</span> F) <span class="sc">+</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">scale_color_viridis</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"Betweenness"</span>) <span class="sc">+</span> </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>( <span class="at">filter=</span>name <span class="sc">%in%</span> {cent_metrics_rnk <span class="sc">%&gt;%</span> <span class="fu">filter</span>(betweenness_rnk <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(name)}, <span class="at">label=</span>name), <span class="at">alpha=</span><span class="fl">0.65</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">repel=</span>T, <span class="at">force =</span> <span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualisering-af-closeness" class="level2">
<h2 class="anchored" data-anchor-id="visualisering-af-closeness">Visualisering af closeness</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>largest_comp_virk <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>(<span class="at">layout=</span><span class="st">'stress'</span>) <span class="sc">+</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color=</span><span class="st">'grey'</span>, <span class="at">width=</span><span class="fl">0.6</span>, <span class="at">alpha=</span><span class="fl">0.35</span>) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>closeness, <span class="at">size =</span> closeness, <span class="at">alpha =</span> closeness), <span class="at">show.legend =</span> F) <span class="sc">+</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span> <span class="fu">scale_color_viridis</span>(<span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"Closeness"</span>) <span class="sc">+</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>( <span class="at">filter=</span>name <span class="sc">%in%</span> {cent_metrics_rnk <span class="sc">%&gt;%</span> <span class="fu">filter</span>(closeness_rnk <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(name)}, <span class="at">label=</span>name), <span class="at">alpha=</span><span class="fl">0.65</span>, <span class="at">repel=</span>T,<span class="at">size=</span><span class="dv">3</span>, <span class="at">force =</span> <span class="dv">20</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 1 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="centralisering" class="level1">
<h1>Centralisering:</h1>
<p><strong>Ide:</strong> Er centraliteten i netværket spredt ud eller koncentreret på få noder</p>
<p><strong>Praksis</strong>: udregnes som “summen af differencen mellem centraliteten for den mest centrale node og de andre” divideret med “den teoretiske situation, hvor én node er central og alle andre perifære” For de fleste centralitetsmål er denne teoretiske situation stjernegrafen, som vi kiggede på tidligere.</p>
<p>Spørgsmålet bliver således, hvor tæt er vi på en situation, hvor én node ‘suger’ al centraliteten.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>deg_cent  <span class="ot">&lt;-</span> <span class="fu">centr_degree</span>(largest_comp_virk)<span class="sc">$</span>centralization</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>deg_cent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03020665</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>clo_cent  <span class="ot">&lt;-</span> <span class="fu">centr_clo</span>(largest_comp_virk)<span class="sc">$</span>centralization </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>clo_cent </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1633791</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>betw_cent <span class="ot">&lt;-</span> <span class="fu">centr_betw</span>(largest_comp_virk)<span class="sc">$</span>centralization </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>betw_cent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05391088</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>eig_cent  <span class="ot">&lt;-</span> <span class="fu">centr_eigen</span>(largest_comp_virk)<span class="sc">$</span>centralization</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>eig_cent</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9397274</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>stargr <span class="ot">&lt;-</span> <span class="fu">make_star</span>(<span class="fu">vcount</span>(largest_comp_virk), <span class="at">mode =</span> <span class="st">"undirected"</span>) </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>lay1 <span class="ot">&lt;-</span> <span class="fu">create_layout</span>(largest_comp_virk, <span class="at">layout =</span> <span class="st">"fr"</span>) </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> stargr <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">"star"</span>) <span class="sc">+</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">edge_width =</span> .<span class="dv">1</span>, <span class="at">edge_alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">degree</span>(stargr), <span class="at">color =</span> <span class="fu">degree</span>(stargr))) <span class="sc">+</span> </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">8</span>)) <span class="sc">+</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>, <span class="at">color =</span> <span class="st">"none"</span>, <span class="at">alpha =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Centralization = 1"</span>)) <span class="sc">+</span> </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> lay1 <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>() <span class="sc">+</span> </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">edge_width =</span> .<span class="dv">1</span>, <span class="at">edge_alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> degree, <span class="at">color =</span> degree, <span class="at">alpha =</span> degree)) <span class="sc">+</span> </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">6</span>)) <span class="sc">+</span> </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>, <span class="at">color =</span> <span class="st">"none"</span>, <span class="at">alpha =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Degree centralization = "</span>, <span class="fu">round</span>(deg_cent,<span class="dv">2</span>))) <span class="sc">+</span> </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> lay1 <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>() <span class="sc">+</span> </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">edge_width =</span> .<span class="dv">1</span>, <span class="at">edge_alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> betweenness, <span class="at">color =</span> betweenness, <span class="at">alpha =</span> betweenness)) <span class="sc">+</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">6</span>)) <span class="sc">+</span> </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>, <span class="at">color =</span> <span class="st">"none"</span>, <span class="at">alpha =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Betwenness centralization = "</span>, <span class="fu">round</span>(betw_cent,<span class="dv">2</span>))) <span class="sc">+</span> </span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> lay1 <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>() <span class="sc">+</span> </span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">edge_width =</span> .<span class="dv">1</span>, <span class="at">edge_alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span>eigencentrality, <span class="at">color =</span> eigencentrality, <span class="at">alpha =</span> eigencentrality)) <span class="sc">+</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">6</span>)) <span class="sc">+</span> </span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>, <span class="at">color =</span> <span class="st">"none"</span>, <span class="at">alpha =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="fu">paste0</span>(<span class="st">"Eigencentrality centralization = "</span>, <span class="fu">round</span>(eig_cent,<span class="dv">2</span>))) <span class="sc">+</span> </span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>()</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(p0, p1, p2, p3)) <span class="sc">%&gt;%</span> <span class="fu">annotate_figure</span>(., <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Graph level centralization"</span>, <span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session4_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><a href="scripts til undervisning/Session3.R" class="btn btn-primary">I kan downloade scriptet her</a> <a href="scripts til undervisning/Session3_øvelse.R" class="btn btn-primary">Øvelser her</a> <a href="scripts til undervisning/Session3_øvelse_med_svar.R" class="btn btn-primary">Øvelser med svar her</a></p>
<p>Husk at lægge dem i scripts mappen i r-projektmappen</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>