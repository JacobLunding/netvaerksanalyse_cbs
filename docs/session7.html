<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Finpudsning af analyse og visualisering af netværk – Kursusmateriale til Virksomhedsstrategi i et netværksperspektiv</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-553db639d176b1f1e5eb8f34e19f9014.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Kursusmateriale til Virksomhedsstrategi i et netværksperspektiv</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Install_guide.html"> 
<span class="menu-text">Install and setup R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./intro.html"> 
<span class="menu-text">Intro til R og Tidyverse</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./kursusmateriale.html"> 
<span class="menu-text">Kursusmateriale</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ggplot-ggraph" id="toc-ggplot-ggraph" class="nav-link active" data-scroll-target="#ggplot-ggraph">ggplot + ggraph</a></li>
  <li><a href="#indlæs-pakker" id="toc-indlæs-pakker" class="nav-link" data-scroll-target="#indlæs-pakker">Indlæs pakker</a></li>
  <li><a href="#indlæs-data" id="toc-indlæs-data" class="nav-link" data-scroll-target="#indlæs-data">Indlæs data</a>
  <ul class="collapse">
  <li><a href="#subset-data" id="toc-subset-data" class="nav-link" data-scroll-target="#subset-data">Subset data</a></li>
  </ul></li>
  <li><a href="#konstruktion-af-netværksmatricer" id="toc-konstruktion-af-netværksmatricer" class="nav-link" data-scroll-target="#konstruktion-af-netværksmatricer">Konstruktion af netværksmatricer</a>
  <ul class="collapse">
  <li><a href="#individ-x-affiliation-matrice" id="toc-individ-x-affiliation-matrice" class="nav-link" data-scroll-target="#individ-x-affiliation-matrice">individ x affiliation matrice:</a></li>
  <li><a href="#individ-x-individ-matricen" id="toc-individ-x-individ-matricen" class="nav-link" data-scroll-target="#individ-x-individ-matricen">Individ x individ matricen:</a></li>
  <li><a href="#affiliation-x-affiliation-matricen" id="toc-affiliation-x-affiliation-matricen" class="nav-link" data-scroll-target="#affiliation-x-affiliation-matricen">affiliation x affiliation matricen:</a></li>
  </ul></li>
  <li><a href="#konstruktion-af-netværksobjekter" id="toc-konstruktion-af-netværksobjekter" class="nav-link" data-scroll-target="#konstruktion-af-netværksobjekter">Konstruktion af netværksobjekter</a>
  <ul class="collapse">
  <li><a href="#two-mode-bipartite" id="toc-two-mode-bipartite" class="nav-link" data-scroll-target="#two-mode-bipartite">two-mode (bipartite)</a></li>
  <li><a href="#individ-netværk" id="toc-individ-netværk" class="nav-link" data-scroll-target="#individ-netværk">Individ-netværk</a></li>
  <li><a href="#affiliation-netværk" id="toc-affiliation-netværk" class="nav-link" data-scroll-target="#affiliation-netværk">Affiliation-netværk</a></li>
  </ul></li>
  <li><a href="#komponenter" id="toc-komponenter" class="nav-link" data-scroll-target="#komponenter">Komponenter</a></li>
  <li><a href="#visualiseringer" id="toc-visualiseringer" class="nav-link" data-scroll-target="#visualiseringer">Visualiseringer:</a>
  <ul class="collapse">
  <li><a href="#initierer-af-et-plot-med-ggraph-funktionen" id="toc-initierer-af-et-plot-med-ggraph-funktionen" class="nav-link" data-scroll-target="#initierer-af-et-plot-med-ggraph-funktionen">1) Initierer af et plot med <code>ggraph()</code>-funktionen</a></li>
  <li><a href="#tegn-edges" id="toc-tegn-edges" class="nav-link" data-scroll-target="#tegn-edges">2) Tegn edges</a></li>
  <li><a href="#tegn-noder" id="toc-tegn-noder" class="nav-link" data-scroll-target="#tegn-noder">3) Tegn noder</a></li>
  <li><a href="#netværkstema-baggrund" id="toc-netværkstema-baggrund" class="nav-link" data-scroll-target="#netværkstema-baggrund">4) Netværkstema (baggrund):</a></li>
  <li><a href="#titel-mv." id="toc-titel-mv." class="nav-link" data-scroll-target="#titel-mv.">5) Titel mv.</a></li>
  <li><a href="#gem-plot-som-en-billede-fil" id="toc-gem-plot-som-en-billede-fil" class="nav-link" data-scroll-target="#gem-plot-som-en-billede-fil">6) Gem plot som en billede fil</a></li>
  </ul></li>
  <li><a href="#visualisering-2.0---mapping-aesthetics" id="toc-visualisering-2.0---mapping-aesthetics" class="nav-link" data-scroll-target="#visualisering-2.0---mapping-aesthetics">Visualisering 2.0 - ‘mapping aesthetics’:</a>
  <ul class="collapse">
  <li><a href="#farve" id="toc-farve" class="nav-link" data-scroll-target="#farve">1) Farve</a>
  <ul class="collapse">
  <li><a href="#farveskalaer-for-ikke-kontinuerte-variable" id="toc-farveskalaer-for-ikke-kontinuerte-variable" class="nav-link" data-scroll-target="#farveskalaer-for-ikke-kontinuerte-variable">1.1 Farveskalaer for ikke kontinuerte variable</a></li>
  </ul></li>
  <li><a href="#ændrer-legends" id="toc-ændrer-legends" class="nav-link" data-scroll-target="#ændrer-legends">2) Ændrer legends</a>
  <ul class="collapse">
  <li><a href="#legend-label-rækkefølge-og-label-værdier" id="toc-legend-label-rækkefølge-og-label-værdier" class="nav-link" data-scroll-target="#legend-label-rækkefølge-og-label-værdier">2.1 legend-label rækkefølge og label-værdier</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#visualisering-3.0---mapping-aesthetics-med-kontinuerte-variable" id="toc-visualisering-3.0---mapping-aesthetics-med-kontinuerte-variable" class="nav-link" data-scroll-target="#visualisering-3.0---mapping-aesthetics-med-kontinuerte-variable">Visualisering 3.0 - ‘mapping aesthetics’ med kontinuerte variable</a>
  <ul class="collapse">
  <li><a href="#size-efter-et-kontinuert-mål-fx.-betweenness" id="toc-size-efter-et-kontinuert-mål-fx.-betweenness" class="nav-link" data-scroll-target="#size-efter-et-kontinuert-mål-fx.-betweenness">1) Size efter et kontinuert mål (fx. betweenness)</a></li>
  </ul></li>
  <li><a href="#visualisering-4.0---rækkefølgen-af-noder." id="toc-visualisering-4.0---rækkefølgen-af-noder." class="nav-link" data-scroll-target="#visualisering-4.0---rækkefølgen-af-noder.">Visualisering 4.0 - rækkefølgen af noder.</a></li>
  <li><a href="#skrifttyper-tekststørrelser-mv." id="toc-skrifttyper-tekststørrelser-mv." class="nav-link" data-scroll-target="#skrifttyper-tekststørrelser-mv.">Skrifttyper, tekststørrelser mv.</a>
  <ul class="collapse">
  <li><a href="#labels-på-et-plot-geom_node_label-og-filter" id="toc-labels-på-et-plot-geom_node_label-og-filter" class="nav-link" data-scroll-target="#labels-på-et-plot-geom_node_label-og-filter">Labels på et plot…! geom_node_label() og filter =</a></li>
  <li><a href="#override-legend-aesthetics" id="toc-override-legend-aesthetics" class="nav-link" data-scroll-target="#override-legend-aesthetics">Override legend aesthetics…</a></li>
  </ul></li>
  <li><a href="#sammensætning-af-plots-med-ggarrange" id="toc-sammensætning-af-plots-med-ggarrange" class="nav-link" data-scroll-target="#sammensætning-af-plots-med-ggarrange">Sammensætning af plots med ggarrange</a></li>
  <li><a href="#visualisering-af-forskellige-mål-med-ggplot" id="toc-visualisering-af-forskellige-mål-med-ggplot" class="nav-link" data-scroll-target="#visualisering-af-forskellige-mål-med-ggplot">Visualisering af forskellige mål… (med ggplot)</a>
  <ul class="collapse">
  <li><a href="#korrelationen-mellem-to-forskellige-mål" id="toc-korrelationen-mellem-to-forskellige-mål" class="nav-link" data-scroll-target="#korrelationen-mellem-to-forskellige-mål">Korrelationen mellem to forskellige mål</a></li>
  <li><a href="#et-mål-men-delt-op-på-en-variabel---facet_wrap" id="toc-et-mål-men-delt-op-på-en-variabel---facet_wrap" class="nav-link" data-scroll-target="#et-mål-men-delt-op-på-en-variabel---facet_wrap">Et mål, men delt op på en variabel - facet_wrap()</a></li>
  <li><a href="#en-masse-mål-i-forhold-til-hinanden" id="toc-en-masse-mål-i-forhold-til-hinanden" class="nav-link" data-scroll-target="#en-masse-mål-i-forhold-til-hinanden">En masse mål i forhold til hinanden</a></li>
  </ul></li>
  <li><a href="#beregning-af-gennemsnit-mv.-delt-op-på-en-variabel" id="toc-beregning-af-gennemsnit-mv.-delt-op-på-en-variabel" class="nav-link" data-scroll-target="#beregning-af-gennemsnit-mv.-delt-op-på-en-variabel">Beregning af gennemsnit mv. delt op på en variabel</a></li>
  <li><a href="#bonus-hvordan-linker-virksomheder-med-forskellige-egenskaber-til-hinanden" id="toc-bonus-hvordan-linker-virksomheder-med-forskellige-egenskaber-til-hinanden" class="nav-link" data-scroll-target="#bonus-hvordan-linker-virksomheder-med-forskellige-egenskaber-til-hinanden">Bonus: Hvordan linker virksomheder med forskellige egenskaber til hinanden</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Finpudsning af analyse og visualisering af netværk</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="ggplot-ggraph" class="level1">
<h1>ggplot + ggraph</h1>
<p>I denne session skal vi se på visualiering af netværk med <code>ggraph-pakken</code>: “En grafisk grammatik for relationel data”, som bygger oven på <code>ggplot2</code>.</p>
<p><img src="images/ggplot.png" class="img-fluid" width="117"></p>
<p><img src="images/clipboard-2969230943.png" class="img-fluid"></p>
<p>Begge dele følger den samme underliggende visualiseringsfilosofi/-grammatik.</p>
<ul>
<li><p>Man initialiserer et plot (et underliggende koordinatsystem) og bringer et datasæt i spil</p></li>
<li><p>Man tilføjer lag (<code>geom_*</code>-funktioner), som definerer hvordan data skal repræsenteres.</p>
<ul>
<li><p>I ggraph() finder der to grupper af lag for hhv. edges og noder</p>
<ul>
<li><p>geom_edge_*</p></li>
<li><p>geom_node_*</p></li>
</ul></li>
</ul></li>
<li><p>Justerer scaler (for akser, størrelser, farver, gennemsigitighed, former osv.) (<code>scale_*</code>-funktioner)</p></li>
<li><p>Ændrer på akse og legends forklaringer med <code>guides()</code> -funktionen, kombineret med fx. <code>guide_legend()</code> og som tillader os at ændre på hvordan en legend ser ud eller <code>guide_axis()</code> som tillader os at ændre på hvordan en akse ser ud. I begge tilfælde kan vi gøre brug af forskellige <code>theme-objekter</code>: fx <code>legend.position</code> eller <code>legend.text</code> kombineret med et <code>theme_element</code> som fx <code>element_text()</code></p></li>
<li><p>Tilføjer prædifinerede temaer med <code>theme_*</code>-funktioner for hele plottet.</p></li>
</ul>
<p>De forskellige muligheder i ggplot kan findes <a href="https://ggplot2.tidyverse.org/reference/index.html">her</a> og det samme for ggraph <a href="https://ggraph.data-imaginist.com/reference/index.html">her</a></p>
<p>Lad os komme igang.</p>
</section>
<section id="indlæs-pakker" class="level1">
<h1>Indlæs pakker</h1>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.6
✔ forcats   1.0.1     ✔ stringr   1.6.0
✔ ggplot2   4.0.1     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.2.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors

Attaching package: 'igraph'


The following objects are masked from 'package:lubridate':

    %--%, union


The following objects are masked from 'package:dplyr':

    as_data_frame, groups, union


The following objects are masked from 'package:purrr':

    compose, simplify


The following object is masked from 'package:tidyr':

    crossing


The following object is masked from 'package:tibble':

    as_data_frame


The following objects are masked from 'package:stats':

    decompose, spectrum


The following object is masked from 'package:base':

    union



Attaching package: 'Matrix'


The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
</div>
</section>
<section id="indlæs-data" class="level1">
<h1>Indlæs data</h1>
<p>Lad os arbejde med noget vi kender godt. Vi indlæser den17 fra datamappen:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>den <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/den17-no-nordic-letters.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 56849 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (8): name, affiliation, role, gender, tags, sector, type, description
dbl (2): cvr_person, cvr_affiliation

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<section id="subset-data" class="level2">
<h2 class="anchored" data-anchor-id="subset-data">Subset data</h2>
<p>Og udvælger en række tags, der tilsammen udgør finansverdenen i den17</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>finans_tags <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Finance"</span>, <span class="st">"FINA"</span>, <span class="st">"Banks"</span>, <span class="st">"Pensions"</span>, <span class="st">"Insurance"</span>, <span class="st">"Venture- og kapitalfonde"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>herfra har vi to muligheder.</p>
<p>1) Enten subsetter vi den til alle positioner, der har et af de pågældende tags:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>den_finans1  <span class="ot">&lt;-</span> <span class="fu">has.tags</span>(den, <span class="at">tags =</span> finans_tags, <span class="at">result =</span> <span class="st">"den"</span>, <span class="at">mode =</span> <span class="st">"or"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Matched positions
Finance                               2266
FINA                                   692
Banks                                  899
Pensions                               454
Insurance                              584
Venture- og kapitalfonde               130

 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(den_finans1, <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 10
   name   affiliation role  gender tags  sector type  cvr_person cvr_affiliation
   &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;           &lt;dbl&gt;
 1 Asger… A/S DANSK … Exec… Men    Corp… Corpo… Virk… 4003993896        73314712
 2 Hans … A/S DANSK … Vice… Men    Corp… Corpo… Virk… 4004141577        73314712
 3 Lars … A/S DANSK … Memb… Men    Corp… Corpo… Virk… 4003896224        73314712
 4 Micha… A/S DANSK … Memb… Men    Corp… Corpo… Virk… 4004121861        73314712
 5 Thork… A/S DANSK … Chai… Men    Corp… Corpo… Virk… 4004010529        73314712
 6 Gille… ALD Automo… Memb… Men    Corp… Corpo… Virk… 4006419783        87573613
 7 Guill… ALD Automo… Chie… Men    Corp… Corpo… Virk… 4004174889        87573613
 8 Micha… ALD Automo… Memb… Men    Corp… Corpo… Virk… 4004256917        87573613
 9 Tim T… ALD Automo… Chai… Men    Corp… Corpo… Virk… 4004038684        87573613
10 Asger… Alm. Brand  Othe… Men    Corp… Corpo… Virk… 4000077224        77333517
# ℹ 1 more variable: description &lt;chr&gt;</code></pre>
</div>
</div>
<p>2) Eller også vælger vi at få en vector med navnene på alle de affiliations, der har et af de pågældende tags:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>finans_affils  <span class="ot">&lt;-</span> <span class="fu">has.tags</span>(den, <span class="at">tags =</span> finans_tags, <span class="at">result =</span> <span class="st">"affil"</span>, <span class="at">mode =</span> <span class="st">"or"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Matched positions
Finance                               2266
FINA                                   692
Banks                                  899
Pensions                               454
Insurance                              584
Venture- og kapitalfonde               130

 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(finans_affils, <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "A/S DANSK ERHVERVSINVESTERING"                                
 [2] "ALD Automotive"                                               
 [3] "Alm. Brand"                                                   
 [4] "Alm. brand - Repraesentantskab (Medlemmer)"                   
 [5] "Alpha Holding"                                                
 [6] "ALTOR EQUITY PARTNERS A/S"                                    
 [7] "Ankenaevnet for Forsikring (Medlemmer)"                       
 [8] "AP Pension"                                                   
 [9] "Arbejdernes Landsbank"                                        
[10] "Arbejdsmarkedets Erhvervssygdomssikring (AES) (Departementet)"</code></pre>
</div>
</div>
<p>Gør vi dét, har vi nemlig mulighed for også at udvælge særlige ting, der ikke har et af de pågældende tags. Det kunne fx være at vi gerne vil have alle VL-grupper med også. Vi laver derfor en vektor med navnene på alle tværgående netværksgrupper, hvor der sidder et individ, som har et finans tag:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>finans_ind <span class="ot">&lt;-</span> <span class="fu">has.tags</span>(den, <span class="at">tags =</span> finans_tags, <span class="at">result =</span> <span class="st">"name"</span>, <span class="at">mode =</span> <span class="st">"or"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Matched positions
Finance                               2266
FINA                                   692
Banks                                  899
Pensions                               454
Insurance                              584
Venture- og kapitalfonde               130

 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(finans_ind)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Asger Ib Mardahl-Hansen" "Hans Ole Jensen"        
[3] "Lars Groenborg Eskesen"  "Michael Noergaard"      
[5] "Thorkild Engell Jensen"  "Gilles Jean-Noël Momper"</code></pre>
</div>
</div>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>den <span class="sc">%&gt;%</span> <span class="fu">count</span>(type)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   type                     n
   &lt;chr&gt;                &lt;int&gt;
 1 Begivenhed            2086
 2 Folketing              241
 3 Fond (CVR)            1783
 4 Kommission             772
 5 Netvaerk (VL-gruppe)  4318
 6 Organisation         14819
 7 Snowball                11
 8 Stat                 10419
 9 Virksomhed (CVR)      9722
10 &lt;NA&gt;                 12678</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>vl_grupper <span class="ot">&lt;-</span> den <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Netvaerk (VL-gruppe)"</span> <span class="sc">&amp;</span> name <span class="sc">%in%</span> finans_ind) <span class="sc">%&gt;%</span>  </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(affiliation) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(affiliation)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Når vi har de to vektorer med affiliation-navne kan vi bruge dem til at subsette data med:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>den_finans2 <span class="ot">&lt;-</span> den <span class="sc">%&gt;%</span> <span class="fu">filter</span>(affiliation <span class="sc">%in%</span> <span class="fu">c</span>(finans_affils, vl_grupper))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(den_finans2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5684   10</code></pre>
</div>
</div>
</section>
</section>
<section id="konstruktion-af-netværksmatricer" class="level1">
<h1>Konstruktion af netværksmatricer</h1>
<p>Lad os fortsætte med den_finans2 (hvor vi har inkluderet netværk også)</p>
<section id="individ-x-affiliation-matrice" class="level2">
<h2 class="anchored" data-anchor-id="individ-x-affiliation-matrice">individ x affiliation matrice:</h2>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bi_adj <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(den_finans2, <span class="at">formula =</span> <span class="sc">~</span>name <span class="sc">+</span> affiliation, <span class="at">sparse =</span> T)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Fra individ x affiliation matricen, kan vi lave to matricer (det er vigtigt at <code>Matrix</code> pakken er læst ind her - <code>library(Matrix)</code>)</p>
</section>
<section id="individ-x-individ-matricen" class="level2">
<h2 class="anchored" data-anchor-id="individ-x-individ-matricen">Individ x individ matricen:</h2>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>adj_ind <span class="ot">&lt;-</span> bi_adj <span class="sc">%*%</span> <span class="fu">t</span>(bi_adj) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="affiliation-x-affiliation-matricen" class="level2">
<h2 class="anchored" data-anchor-id="affiliation-x-affiliation-matricen">affiliation x affiliation matricen:</h2>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>adj_affil <span class="ot">&lt;-</span> <span class="fu">t</span>(bi_adj) <span class="sc">%*%</span> bi_adj</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="konstruktion-af-netværksobjekter" class="level1">
<h1>Konstruktion af netværksobjekter</h1>
<section id="two-mode-bipartite" class="level2">
<h2 class="anchored" data-anchor-id="two-mode-bipartite">two-mode (bipartite)</h2>
<p>fra individ x affiliation matricen (<code>bi_adj</code>) laver vi et bipartite/two-mode netværksobjekt</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>net_twomode <span class="ot">&lt;-</span> <span class="fu">graph_from_biadjacency_matrix</span>(bi_adj, <span class="at">directed =</span> <span class="cn">FALSE</span>, <span class="at">multiple =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">simplify</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>net_twomode</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH fbc4a48 UN-B 5147 5684 -- 
+ attr: type (v/l), name (v/c)
+ edges from fbc4a48 (vertex names):
[1] Aage Almtoft            --Middelfart Sparekasse                                                        
[2] Aage B. Andersen        --Foreningen OEstifterne - Repraesentantskab (Medlemmer af delegeretforsamling)
[3] AAge Dragsted           --VL gruppe 35 – Aarhus                                                        
[4] AAke Per-Urban Bäckström--Danske Bank                                                                  
[5] Aase Hoeck              --Dansk Aktionaerforening (repraesentantskab)                                  
+ ... omitted several edges</code></pre>
</div>
</div>
</section>
<section id="individ-netværk" class="level2">
<h2 class="anchored" data-anchor-id="individ-netværk">Individ-netværk</h2>
<p>fra individ x individ matricen (<code>adj_ind</code>) laver vi et one-mode netværk for individer</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>net_ind <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(adj_ind, <span class="at">mode =</span> <span class="st">"undirected"</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">simplify</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>net_ind</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH f0ebc15 UN-- 4816 89658 -- 
+ attr: name (v/c)
+ edges from f0ebc15 (vertex names):
 [1] Aage Almtoft    --Allan Buch             
 [2] Aage Almtoft    --Bettina Joergensen     
 [3] Aage Almtoft    --Bo Skovby Rosendahl    
 [4] Aage Almtoft    --Bo Smith 4493          
 [5] Aage Almtoft    --Claus Nielsen 50129    
 [6] Aage Almtoft    --Jan Melgaard           
 [7] Aage Almtoft    --Martin Noerholm Baltser
 [8] Aage Almtoft    --Michael Frandsen       
+ ... omitted several edges</code></pre>
</div>
</div>
</section>
<section id="affiliation-netværk" class="level2">
<h2 class="anchored" data-anchor-id="affiliation-netværk">Affiliation-netværk</h2>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>net_affil <span class="ot">&lt;-</span> <span class="fu">graph_from_adjacency_matrix</span>(adj_affil, <span class="at">mode =</span> <span class="st">"undirected"</span>, <span class="at">diag =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">simplify</span>()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>net_affil</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>IGRAPH a2d85dd UN-- 331 984 -- 
+ attr: name (v/c)
+ edges from a2d85dd (vertex names):
[1] A/S DANSK ERHVERVSINVESTERING--FAGBEVAEGELSENS ERHVERVSINVESTERING A/S (Bestyrelse)                   
[2] A/S DANSK ERHVERVSINVESTERING--VL gruppe 4 - Koebenhavn                                               
[3] Alm. Brand                   --Alm. brand - Repraesentantskab (Medlemmer)                             
[4] Alm. Brand                   --Byggesocietetet (Koebenhavnsudvalget )                                 
[5] Alm. Brand                   --DFL - Danske Forsikringsfunktionaerers Landsforening (Hovedbestyrelsen)
+ ... omitted several edges</code></pre>
</div>
</div>
</section>
</section>
<section id="komponenter" class="level1">
<h1>Komponenter</h1>
<p>I det fleste tilfælde vil vi gerne nøjes med at visualere de største komponenter i vores netværk, så vi laver tre reducerede netværksobjekter, som kun indeholder de største komponenter:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>net_twomode_l <span class="ot">&lt;-</span> <span class="fu">largest_component</span>(net_twomode)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>net_ind_l     <span class="ot">&lt;-</span> <span class="fu">largest_component</span>(net_ind)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>net_affil_l   <span class="ot">&lt;-</span> <span class="fu">largest_component</span>(net_affil)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="visualiseringer" class="level1">
<h1>Visualiseringer:</h1>
<p>Lad os tage hul på logikken i visualering af netværk med <code>ggraph</code>.</p>
<p>Vi begynder med et simpelt plot: virksomhedsnetværket.</p>
<section id="initierer-af-et-plot-med-ggraph-funktionen" class="level2">
<h2 class="anchored" data-anchor-id="initierer-af-et-plot-med-ggraph-funktionen">1) Initierer af et plot med <code>ggraph()</code>-funktionen</h2>
<p>Først initierer vi et plot med <code>ggraph()</code> funktionen og et netværksobjekt:</p>
<p>Det giver os et øjensynligt tomt plot. Funktionen har dog allerede defineret ét lag, nemlig layout-laget. Da vi ikke har specificeret noget layout har ggraph brugt default layoutet <code>stress</code></p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(net_affil_l)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using "stress" as default layout</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tegn-edges" class="level2">
<h2 class="anchored" data-anchor-id="tegn-edges">2) Tegn edges</h2>
<p>det næste vi tilføjer er oftest laget med edges. Fordi vi lægger lag-på-lag, er det vigtig hvilken rækkefølge vi gør det i. Visuelt giver det mest mening at lægge edges på først, så de ikke ligger oven på noderne:</p>
<p>Når vi tilføjer lag i ggraph bruger vi geom’er som i ggplot. Der er som nævnt et specifikt sæt af geom’er for edges, <code>geom_edge_*</code>. Oftest vil vi tegne dem som en ‘streg’ og bruger derfor <code>geom_edge_link0</code> :</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_edge_link0</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>da vi har et relativt stort og dense netværk (der er 984 edges), vil vi måske gerne gøre dem mindre visuelt dominerende. I <code>geom_edge_*</code> funktionerne kan vi ændre på en række parametre:</p>
<ul>
<li><p>width (tykkelsen på linjerne)</p>
<ul>
<li>som går fra 0 (ingen tykkelse) til uendeligt tykke.</li>
</ul></li>
<li><p>color (farven på linjerne)</p>
<ul>
<li>kan være en hex farvekode, fx. #f50e0a (en variant af rød) eller en navngiven farve. (brug evt. funktionen <code>edit(colors())</code> til at se de navngivne farver i R)</li>
</ul></li>
<li><p>alpha (linjernes ‘gennemsigtighed’)</p>
<ul>
<li>som går fra 0 til 1 (0 = helt gennemsigtige, 1 = helt optegnede)</li>
</ul></li>
</ul>
<p>Lad os prøve at sætte en farve, en variant af grå, og en tykkelse, 0.3, og en gennemsigtighed, 0.3.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_edge_link0</span>(<span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tegn-noder" class="level2">
<h2 class="anchored" data-anchor-id="tegn-noder">3) Tegn noder</h2>
<p>Nu vil vi gerne tilføje laget med noder (i dette tilfælde virksomheder).</p>
<p>Der også et specifikt sæt af geom’er for noder, <code>geom_node_*</code>. Oftest vil vi tegne dem som et ‘punkt’, så vi bruger <code>geom_node_point()</code>:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_node_point</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I <code>geom_node_*</code> funktionerne kan vi også ændre på en række parametre:</p>
<ul>
<li><p>size (størrelsen på punkterne)</p>
<ul>
<li>som går fra 0 (ingen størrelse) til uendelig størrelse.</li>
</ul></li>
<li><p>shape (formen på punktet)</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/shapes.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="331"></p>
</figure>
</div>
<ul>
<li><p>color (farven på punktet/ eller på punktets omkreds - hvis man vælger en af de ‘røde’ shapes fra figuren og sætter en anden fill)</p>
<ul>
<li>kan være en hex farvekode, fx. #f50e0a (en variant af rød) eller en navngiven farve. (brug evt. funktionen <code>edit(colors())</code> til at se de navngivne farver i R)</li>
</ul></li>
<li><p>fill (styrer for de røde shapes farven på punktet, mens color så styrer omkredsen)</p></li>
<li><p>alpha (linjernes ‘gennemsigtighed’)</p>
<ul>
<li>som går fra 0 til 1 (0 = helt gennemsigtige, 1 = helt optegnede)</li>
</ul></li>
</ul>
<p>Lad os sætte en størrelse på 3, en rund shape med farve, nr. 21, en alpha på 0.75, en omkredsfarve (color), sort, og en fill, salmon2.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">fill =</span> <span class="st">"salmon2"</span>,<span class="at">alpha =</span> <span class="fl">0.75</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="netværkstema-baggrund" class="level2">
<h2 class="anchored" data-anchor-id="netværkstema-baggrund">4) Netværkstema (baggrund):</h2>
<p>Nu har vi næsten lavet vores simple plot. Der er dog noget med den grå baggrund…. I ggraph ligger der et standard theme til netværksvisualiseringer, <code>theme_graph()</code>, lad os tilføje det.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme_graph</span>()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="titel-mv." class="level2">
<h2 class="anchored" data-anchor-id="titel-mv.">5) Titel mv.</h2>
<p>Som det sidte vil vi måske gerne tilføje en forklarende titel til vores visualisering.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Virksomhedsnetværket i finanssektoren"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>og måske også en undertitel. Det kunne være antallet af noder (eller noget helt andet). Vi vi gerne vil ‘blande’ et tal ind uden at skrive det selv. Fx så vi kan opdatere analysen og køre koden uden at ændre plotkoden, kan vi bruge <code>paste0()</code> til at sætte tekst og outputtet fra en funktion sammen: <code>paste0("n = ", vcount(net_affil_l))</code> vil sætte “n =” sammen med outputtet fra <code>vcount()</code> som er antallet af noder.</p>
<p>Vi kan også tilføje en <code>caption</code> i hjørnet med <code>labs(caption =)</code> faktisk kan man også bestemme title og subtitle med labs.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Enten </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Virksomhedsnetværket i finanssektoren"</span>, <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l))) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Eller det hele med labs</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Opsummerende kan vi gøre det hele på en gang i stedet:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(net_affil_l) <span class="sc">+</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="st">"salmon2"</span>,<span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using "stress" as default layout</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>p  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gem-plot-som-en-billede-fil" class="level2">
<h2 class="anchored" data-anchor-id="gem-plot-som-en-billede-fil">6) Gem plot som en billede fil</h2>
<p>ggplot2 har en funktion, der hedder <code>ggsave()</code> som gemmer det aktive plot (eller et bestemt plot objekt) til en sti vi vælger og et filformat vi bestemmer. Hvis den mappe vi ‘sender’ filen til ikke findes, kan man bruge <code>create.dir = TRUE</code>, så laver R mappen.</p>
<p>Jeg vil gerne gemme til min output mappe (der må gerne stå create.dir = TRUE, også selvom den allerede findes). Og det skal være en png fil.</p>
<p>Andre relevante options er <code>height =</code> og <code>width =</code> . Dem kan I skrue på hvis plottet bliver enten for stort elle for lille i den fil i gemmer.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"output/simpelt_plot.png"</span>, <span class="at">plot =</span> p, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">create.dir =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="visualisering-2.0---mapping-aesthetics" class="level1">
<h1>Visualisering 2.0 - ‘mapping aesthetics’:</h1>
<p>Indtil nu har vi sat nogle faste værdier for størrelse og tykkelse mv. Vi kunne fx godt være interesseret i at lade en variabel styre nodernes farve eller størrelse eller lignende.</p>
<p>Lad os derfor først lige tilføje sektor-variablen til vores netværksobjekt som en vertex attribute:</p>
<p>først vil vi gerne lige sørge for at <code>sector = NA</code> bliver til <code>sector = "Unknown"</code></p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>den <span class="ot">&lt;-</span> den <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sector =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(sector)<span class="sc">~</span><span class="st">"Unknown"</span>, <span class="at">.default =</span> sector))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>net_affil_l <span class="ot">&lt;-</span> <span class="fu">add_vertex_attr</span>(<span class="at">graph =</span> net_affil_l, </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> den <span class="sc">%&gt;%</span> <span class="fu">select</span>(affiliation, sector, tags) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(),</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">match_var =</span> <span class="st">"affiliation"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="farve" class="level2">
<h2 class="anchored" data-anchor-id="farve">1) Farve</h2>
<p>Hvis man gerne vil lade farven følge værdierne på en variabel, skal man bruge <code>mapping = aes()</code> i <code>geom_*</code> funktionen.</p>
<p>Hvis vi genbruger plot koden for edges, theme og title fra før (men undlader nodes)</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(net_affil_l) <span class="sc">+</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>)  <span class="sc">+</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using "stress" as default layout</code></pre>
</div>
</div>
<p>og nu tilføjer en anden variant af <code>geom_node_point()</code> laget.</p>
<p>Vi kan lade size, shape, alpha og color forblive uden for vores mapping, dvs. som konstante værdier. Hvis vi mapper sector henover fill, farver vi indholdet i cirklerne efter sektor</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">color =</span> <span class="st">"grey15"</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> sector))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>vi kan også mappe sector henover color og lade både indhold og omkreds være styret af sector.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> sector, <span class="at">fill =</span> sector))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Eller samlet :</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(net_affil_l) <span class="sc">+</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> sector, <span class="at">fill =</span> sector)) <span class="sc">+</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using "stress" as default layout</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="farveskalaer-for-ikke-kontinuerte-variable" class="level3">
<h3 class="anchored" data-anchor-id="farveskalaer-for-ikke-kontinuerte-variable">1.1 Farveskalaer for ikke kontinuerte variable</h3>
<p>Lad os nu sige vi vælge en anden farveskala: Til det skal vi have fat i et <code>scales_*</code> element.</p>
<p><code>scale_color_*</code> og <code>scale_fill_*</code> er de to scale elementer vi skal bruge for at ændre farveskalaen på color og fill:</p>
<p>med <code>scale_*_manual()</code> kan man sætte farverne selv.</p>
<p>med <code>scale_*_brewer()</code> kan man bruge værdierne fra en defineret palette</p>
<p>kør fx <code>RColorBrewer::display.brewer.all()</code></p>
<p>Lad os prøve en farveskala fra brewer</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># enten</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># eller i en linje</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>, <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"color"</span>, <span class="st">"fill"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-33-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vi kan også konstruere vores egen farve skale:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Commissions"</span> <span class="ot">=</span> <span class="st">"deeppink4"</span>, <span class="st">"Corporations"</span> <span class="ot">=</span> <span class="st">"steelblue1"</span>, <span class="st">"Family"</span> <span class="ot">=</span> <span class="st">"forestgreen"</span>, <span class="st">"Foundations"</span> <span class="ot">=</span><span class="st">"steelblue4"</span>, <span class="st">"NGO"</span> <span class="ot">=</span> <span class="st">"salmon1"</span> , <span class="st">"State"</span> <span class="ot">=</span> <span class="st">"magenta"</span>, <span class="st">"Unknown"</span><span class="ot">=</span> <span class="st">"grey25"</span>, <span class="st">"VL_networks"</span> <span class="ot">=</span> <span class="st">"brown"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>og bruge den med <code>scale_*_manual()</code></p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors, <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"color"</span>, <span class="st">"fill"</span>)) </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ændrer-legends" class="level2">
<h2 class="anchored" data-anchor-id="ændrer-legends">2) Ændrer legends</h2>
<p>Som udgangspunkt får vores legend navn efter den variabel vi mapper. Det kan jo godt vi gerne vil ændre det:</p>
<p>Her kan vi bruge <code>guides()</code> funktionen + <code>guide_legend()</code></p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Sektor"</span>), </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Sektor"</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vi kan også ændre på legends placering: (left, bottom, right (default))</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="legend-label-rækkefølge-og-label-værdier" class="level3">
<h3 class="anchored" data-anchor-id="legend-label-rækkefølge-og-label-værdier">2.1 legend-label rækkefølge og label-værdier</h3>
<p>Hvis vi gerne vil ændre rækkefølgen af værdierne på vores legend kan vi definere det i <code>scale_*_*</code> elementet for både color og fill samtidigt.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Family"</span>, <span class="st">"VL_networks"</span>, <span class="st">"Corporations"</span>, <span class="st">"Foundations"</span>, <span class="st">"State"</span>, <span class="st">"Commissions"</span>, <span class="st">"NGO"</span>, <span class="st">"Unknown"</span>), <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"color"</span>, <span class="st">"fill"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for colour is already present.
Adding another scale for colour, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vi kan også ændre navnene:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Family"</span>, <span class="st">"VL_networks"</span>, <span class="st">"Corporations"</span>, <span class="st">"Foundations"</span>, <span class="st">"State"</span>, <span class="st">"Commissions"</span>, <span class="st">"NGO"</span>, <span class="st">"Unknown"</span>), </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Familie"</span>, <span class="st">"VL-grupper"</span>, <span class="st">"Virksomheder"</span>, <span class="st">"Fonde"</span>, <span class="st">"Staten"</span>, <span class="st">"Kommissioner"</span>, <span class="st">"NGOer"</span>, <span class="st">"Ukendt"</span>), </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">"color"</span>, <span class="st">"fill"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for colour is already present.
Adding another scale for colour, which will replace the existing scale.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="visualisering-3.0---mapping-aesthetics-med-kontinuerte-variable" class="level1">
<h1>Visualisering 3.0 - ‘mapping aesthetics’ med kontinuerte variable</h1>
<p>Lad os beregne betweenness centralitet i vores netværk og lave en rank variabel også</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>bet     <span class="ot">&lt;-</span> <span class="fu">betweenness</span>(net_affil_l, <span class="at">normalized =</span> T)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>bet_rnk <span class="ot">&lt;-</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(bet))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>dem kan vi tilføje til grafobjektet</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(net_affil_l)<span class="sc">$</span>bet <span class="ot">&lt;-</span> bet</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(net_affil_l)<span class="sc">$</span>bet_rnk <span class="ot">&lt;-</span> bet_rnk</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Vi gør det samme for closeness (fordi vi skal bruge det senere)</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>clo     <span class="ot">&lt;-</span> <span class="fu">closeness</span>(net_affil_l, <span class="at">normalized =</span> T)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>clo_rnk <span class="ot">&lt;-</span> <span class="fu">dense_rank</span>(<span class="fu">desc</span>(clo))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(net_affil_l)<span class="sc">$</span>clo <span class="ot">&lt;-</span> clo</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(net_affil_l)<span class="sc">$</span>clo_rnk <span class="ot">&lt;-</span> clo_rnk</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="size-efter-et-kontinuert-mål-fx.-betweenness" class="level2">
<h2 class="anchored" data-anchor-id="size-efter-et-kontinuert-mål-fx.-betweenness">1) Size efter et kontinuert mål (fx. betweenness)</h2>
<p>Her sætter vi fill uden for vores mapping og giver den en konstant værdi, og sætter i stedet size ind i mapping’en og lader den følge betweennes værdien</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(net_affil_l) <span class="sc">+</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, <span class="at">fill =</span> <span class="st">"salmon2"</span>, </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> bet)) <span class="sc">+</span> </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>,  </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using "stress" as default layout</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Vi kan også lade størrelse være styret af betweenness og stadige have farve efter sector:</p>
<p>med <code>scale_color_*</code> vælger vi farveskala (her kan vi også sætte legendnavnet med <code>name =</code>)</p>
<p>med <code>scale_size_*</code> vælger vi størrelsesskalaen for punkterne. Da betweenness er et kontinuert mål, bruger vi <code>size_scale_continous()</code>, hvor vi kan sætte en <code>range = c(min, max)</code></p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(net_affil_l) <span class="sc">+</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> bet, <span class="at">fill =</span> sector)) <span class="sc">+</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">name =</span> <span class="st">"Sektor"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Betwenness centrality"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>)) <span class="sc">+</span> </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using "stress" as default layout</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="visualisering-4.0---rækkefølgen-af-noder." class="level1">
<h1>Visualisering 4.0 - rækkefølgen af noder.</h1>
<p>Som I kan se plotter den noderne i den rækkefølge de har i netværksobjektet. Her kunne vi måske godt tænke os at de centrale noder bliver plottet til sidst, så de ligger ‘øverst’ på lærredet.</p>
<p>Det er der desværre ikke nogen ‘nem’ måde at gøre på, men vi kan bruge en funktion fra <code>ggraph</code> til at lave et layout først, som vi kan sortere.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">create_layout</span>(net_affil_l, <span class="st">"stress"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>nu har vi x og y koordinaterne for alle noder samt også deres vertex attributes i et tibble objekt:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(layout)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "x"                  "y"                  "circular"          
 [4] "name"               "sector"             "tags"              
 [7] "bet"                "bet_rnk"            "clo"               
[10] "clo_rnk"            ".ggraph.orig_index" ".ggraph.index"     </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(layout)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 12
       x       y circular name        sector tags      bet bet_rnk   clo clo_rnk
   &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt;    &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;dbl&gt;   &lt;int&gt;
1 -0.333  2.55   FALSE    A/S DANSK … Corpo… Corp… 1.18e-4     196 0.267     156
2  0.121 -0.812  FALSE    Alm. Brand  Corpo… Corp… 1.27e-2      57 0.337      51
3 -0.760 -1.35   FALSE    Alm. brand… NGO    Boar… 2.41e-2      29 0.340      47
4 -0.132  2.29   FALSE    Ankenaevne… State  Busi… 3.79e-3     117 0.283     130
5 -2.30  -0.0924 FALSE    AP Pension  Corpo… Corp… 1.28e-2      55 0.350      36
6 -1.32   0.700  FALSE    Arbejderne… Corpo… Corp… 1.17e-2      66 0.373      15
# ℹ 2 more variables: .ggraph.orig_index &lt;int&gt;, .ggraph.index &lt;int&gt;</code></pre>
</div>
</div>
<p>Vi kan nu sortere (<code>arrange()</code>) layoutfilen efter betweenness (<code>bet</code>) før vi ‘sender den’ til ggraph() funktionen. Det giver dog et nyt problem, da koordinaterne for edges ikke automatisk følger med:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>layout <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(bet) <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>() <span class="sc">+</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> bet, <span class="at">fill =</span> sector)) <span class="sc">+</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">name =</span> <span class="st">"Sektor"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Betwenness centrality"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>)) <span class="sc">+</span> </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>UPS!!!</p>
<p>Jeg har skrevet en funktion <code>get_edge_coord()</code> som sources med <code>networkfunctions.R</code> scriptet.</p>
<p>hvis I sætter den funktion ind i <code>geom_edge_link0</code> elementet som <code>data = get_edge_coord('netværksobjeltet', 'layout tibble')</code>, så beregner den de rigtige koordinater, som så skal mappes over x, y, xend og yend i <code>aes()</code></p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(bet) <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>() <span class="sc">+</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">data =</span> <span class="fu">get_edge_coord</span>(net_affil_l, layout), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend), <span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> bet, <span class="at">fill =</span> sector)) <span class="sc">+</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">name =</span> <span class="st">"Sektor"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Betwenness centrality"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>)) <span class="sc">+</span> </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>() <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="skrifttyper-tekststørrelser-mv." class="level1">
<h1>Skrifttyper, tekststørrelser mv.</h1>
<p>Det er meget simpelt efterfølgende at ændre på teksttype og størrelse i ens plot.</p>
<p><code>base_family</code> sætter skritftypen (serif, sans, mono) for hele plottet</p>
<p><code>base_size</code> sætter skriftstørrelsen for hele plottet</p>
<p><code>title_size</code>, sætter titel skrifstørrelse,</p>
<p><code>subtitle_size</code>, sætter skriftstørrelse for underoverskrift</p>
<p>osv.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">theme_graph</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>, <span class="at">base_size =</span> <span class="dv">12</span>, <span class="at">title_size =</span> <span class="dv">16</span>, <span class="at">subtitle_size =</span> <span class="dv">10</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="labels-på-et-plot-geom_node_label-og-filter" class="level2">
<h2 class="anchored" data-anchor-id="labels-på-et-plot-geom_node_label-og-filter">Labels på et plot…! geom_node_label() og filter =</h2>
<p>Vi har sjældent brug for at sætte label på alle noder, men vi vil måske gerne sætte labels på de 3 mest centrale noder? Eller på et udvalg af noder. Til det kan vi bruge geom’et <code>geom_node_label()</code> og ‘mappe’ vertex attribute’en <code>name</code> hen over koordinaterne.</p>
<p>Fordi vi ikke vil plotte alle label, bruger vi parameteret filter i aes():</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_node_label</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">filter =</span> bet_rnk<span class="sc">&lt;=</span><span class="dv">3</span>, <span class="at">label =</span> name))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_node_label(mapping = aes(filter = bet_rnk &lt;= 3, label = name)):
Ignoring unknown parameters: `label.size`</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hvis labels ligger oven i hinanden kan det være nyttigt at tilføje parameteret <code>repel = TRUE</code>.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_node_label</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">filter =</span> bet_rnk<span class="sc">&lt;=</span><span class="dv">3</span>, <span class="at">label =</span> name), <span class="at">repel =</span> T)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Måske er mine labels for store? Vi kan ændre på størrelsen og også på deres gennemsigtighed (alpha) samt på text typen <code>family</code> så den passer til resten af plottet</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_node_label</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">filter =</span> bet_rnk<span class="sc">&lt;=</span><span class="dv">3</span>, <span class="at">label =</span> name), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">repel =</span> T) </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>det ser efterhånden meget godt ud… Måske er jeg ked af at størrelsen på cirklerne i min color legend er så små. Det kan jeg også justere på med <code>guides()</code> og <code>guide_legend()</code> :</p>
</section>
<section id="override-legend-aesthetics" class="level2">
<h2 class="anchored" data-anchor-id="override-legend-aesthetics">Override legend aesthetics…</h2>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>)))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Lad os gemme det plot også :</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"output/betweennescentralitet_plot.png"</span>, <span class="at">plot =</span> p, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">width =</span> <span class="dv">9</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Standard units på height og width er inches (in). Måske er det lettere for os at bruge cm.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="st">"output/betweennescentralitet_plot.png"</span>, <span class="at">plot =</span> p, <span class="at">height =</span> <span class="dv">16</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Kig på filen og juster størrelsen, så forholdet mellem plot og lærred (og tekst- og punktstørrelse mv.) ser fornuftigt ud.</p>
</section>
</section>
<section id="sammensætning-af-plots-med-ggarrange" class="level1">
<h1>Sammensætning af plots med ggarrange</h1>
<p>Lad os efter samme fremgangsmåde som før lave et plot med closeness i stedet:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>p_clo <span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(clo) <span class="sc">%&gt;%</span> <span class="fu">ggraph</span>() <span class="sc">+</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link0</span>(<span class="at">data =</span> <span class="fu">get_edge_coord</span>(net_affil_l, layout), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend), <span class="at">color =</span> <span class="st">"grey70"</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> clo, <span class="at">fill =</span> sector)) <span class="sc">+</span> </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">filter =</span> clo_rnk<span class="sc">&lt;=</span><span class="dv">3</span>, <span class="at">label =</span> name), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">family =</span> <span class="st">"serif"</span>, <span class="at">repel =</span> T) <span class="sc">+</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">name =</span> <span class="st">"Sektor"</span>, <span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"Closeness centrality"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>)) <span class="sc">+</span> </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_graph</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>, </span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">base_size =</span> <span class="dv">12</span>, </span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">title_size =</span> <span class="dv">16</span>, </span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Virksomhedsnetværket i finanssektoren"</span>, </span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"n = "</span>, <span class="fu">vcount</span>(net_affil_l)), </span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"datakilde: Danish Elitenetwork 2017"</span>) <span class="sc">+</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>)))</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>p_clo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Med funktionen <code>ggarrange()</code> fra ggpubr kan vi sætte plots sammen:</p>
<p>Først vil vi måske gerne lige fjerne legends for size, da de nu betyder to forskellige ting:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>p     <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>p_clo <span class="ot">&lt;-</span> p_clo <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>og ændre overskriften:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>p      <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Betwenness"</span>, <span class="at">subtitle =</span> <span class="st">""</span>, <span class="at">caption =</span> <span class="st">""</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>p_clo  <span class="ot">&lt;-</span> p_clo <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Closeness"</span>, <span class="at">subtitle =</span> <span class="st">""</span>, <span class="at">caption =</span> <span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(p, p_clo), <span class="at">common.legend =</span> T, <span class="at">legend =</span> <span class="st">"right"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualisering-af-forskellige-mål-med-ggplot" class="level1">
<h1>Visualisering af forskellige mål… (med ggplot)</h1>
<p>Vi kan beregne en række centralitetsmål:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name              =</span> <span class="fu">V</span>(net_affil_l)<span class="sc">$</span>name,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sector            =</span> <span class="fu">V</span>(net_affil_l)<span class="sc">$</span>sector,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tags              =</span> <span class="fu">V</span>(net_affil_l)<span class="sc">$</span>tags,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree            =</span> <span class="fu">degree</span>(net_affil_l),</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">betweenness       =</span> <span class="fu">betweenness</span>(net_affil_l, <span class="at">normalized =</span> T),</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">local_betweenness =</span> <span class="fu">betweenness</span>(net_affil_l, <span class="at">cutoff =</span> <span class="dv">2</span>, <span class="at">normalized =</span> T),</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">closeness         =</span> <span class="fu">closeness</span>(net_affil_l), </span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">brokerage         =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">constraint</span>(net_affil_l) </span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>)       </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="korrelationen-mellem-to-forskellige-mål" class="level2">
<h2 class="anchored" data-anchor-id="korrelationen-mellem-to-forskellige-mål">Korrelationen mellem to forskellige mål</h2>
<p>Vi kan fx plotte korrelationen mellem betweenness og brokerage</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> brokerage, <span class="at">y =</span> betweenness, <span class="at">color=</span>sector, <span class="at">size=</span>degree)) <span class="sc">+</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_label(aes(x = brokerage, y = closeness, label = name2)) +</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span>colors) <span class="sc">+</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">max</span>(metrics<span class="sc">$</span>brokerage), <span class="dv">1</span>), <span class="at">name =</span> <span class="st">"1/Burts constraint"</span>) <span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Betweenness"</span>) <span class="sc">+</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>), <span class="at">title =</span> <span class="st">"Virksomhedstype"</span>),</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Degree centralitet"</span>)) <span class="sc">+</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="et-mål-men-delt-op-på-en-variabel---facet_wrap" class="level2">
<h2 class="anchored" data-anchor-id="et-mål-men-delt-op-på-en-variabel---facet_wrap">Et mål, men delt op på en variabel - facet_wrap()</h2>
<p>Der er ikke ret mange noder i kategorierne Commissions og Unknown, så dem filterer vi lige fra her.</p>
<p>Vi kan nu prøve at se hvor stor en andel af noderne i de forskellige sektorer, der ligger hhv. højt og lavt på fx brogerage.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>sector <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Commissions"</span>, <span class="st">"Unknown"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> brokerage, <span class="at">fill=</span>sector)) <span class="sc">+</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">'share'</span>) <span class="sc">+</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sector) <span class="sc">+</span> </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span>colors) <span class="sc">+</span> </span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"serif"</span>) <span class="sc">+</span> </span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="en-masse-mål-i-forhold-til-hinanden" class="level2">
<h2 class="anchored" data-anchor-id="en-masse-mål-i-forhold-til-hinanden">En masse mål i forhold til hinanden</h2>
<p>Her kan I bruge min cor_plots funktion, husk at droppe variable i <code>metrics</code>&nbsp;der ikke er centralitetsvariable (her <code>name</code> og <code>sector</code>)</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>p_cor <span class="ot">&lt;-</span> <span class="fu">cor_plots</span>(<span class="at">metrics_table =</span> metrics <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>name,<span class="sc">-</span>sector, <span class="sc">-</span>tags))</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>p_cor</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session7_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="beregning-af-gennemsnit-mv.-delt-op-på-en-variabel" class="level1">
<h1>Beregning af gennemsnit mv. delt op på en variabel</h1>
<p>Lad os kigge på tags, er der forskel på centralitetsmålene, hvis vi deler noderne op efter deres tags:</p>
<p><strong>Første</strong> skal vi lige <strong>huske</strong> at en node kan have flere tags. Men <code>separate_longer_delim()</code>&nbsp;laver vi en nu data tibble, med en række for hver virksomhed for hver tag.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>metrics_long <span class="ot">&lt;-</span> metrics <span class="sc">%&gt;%</span> <span class="fu">separate_longer_delim</span>(tags, <span class="at">delim =</span> <span class="st">", "</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Vi vil gerne nøjes med at kigge på vores finans tags, så vi nøjes med de rækker:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>metrics_long <span class="ot">&lt;-</span> metrics_long <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tags <span class="sc">%in%</span> finans_tags)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>metrics_long <span class="sc">%&gt;%</span> <span class="fu">count</span>(tags)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  tags                         n
  &lt;chr&gt;                    &lt;int&gt;
1 Banks                       50
2 FINA                        50
3 Finance                    157
4 Insurance                   31
5 Pensions                    32
6 Venture- og kapitalfonde    18</code></pre>
</div>
</div>
<p>Vi lægger lige FINA og Finance sammen og tager kun unikke name + tags kombinationer (for at slette den ene række for dem, der havde både FINA og Finance. <code>.keep_all = TRUE</code> gør at vi beholder alle kolonner.</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>metrics_long <span class="ot">&lt;-</span> metrics_long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tags =</span> <span class="fu">case_when</span>(tags <span class="sc">==</span> <span class="st">"FINA"</span><span class="sc">~</span> <span class="st">"Finance"</span>, <span class="at">.default =</span> tags)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(name, tags, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Nu kan vi med <code>group_by</code> og <code>summarise</code> beregne hhv mean max og min for udvalgte centralitetsmål opdelt på tags (som vi gruppere efter)</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>metrics_long <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(tags) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n_distinct</span>(name), </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(<span class="st">"degree"</span>, <span class="st">"closeness"</span>,<span class="st">"betweenness"</span>, <span class="st">"brokerage"</span>), </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"Mean"</span> <span class="ot">=</span> mean, <span class="st">"Max"</span> <span class="ot">=</span> max, <span class="st">"Min"</span> <span class="ot">=</span> min)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 14
  tags          n degree_Mean degree_Max degree_Min closeness_Mean closeness_Max
  &lt;chr&gt;     &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;
1 Banks        50       10.4          35          1        0.00118       0.00147
2 Finance     157        8.30         35          1        0.00110       0.00147
3 Insurance    31        8.42         31          1        0.00115       0.00146
4 Pensions     32        9.56         31          1        0.00118       0.00148
5 Venture-…    18        4.67         25          1        0.00100       0.00137
# ℹ 7 more variables: closeness_Min &lt;dbl&gt;, betweenness_Mean &lt;dbl&gt;,
#   betweenness_Max &lt;dbl&gt;, betweenness_Min &lt;dbl&gt;, brokerage_Mean &lt;dbl&gt;,
#   brokerage_Max &lt;dbl&gt;, brokerage_Min &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="bonus-hvordan-linker-virksomheder-med-forskellige-egenskaber-til-hinanden" class="level1">
<h1>Bonus: Hvordan linker virksomheder med forskellige egenskaber til hinanden</h1>
<p>Lad os kigge på sektor</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Forholdet mellem ties indenfor og mellem tags</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># vi henter en edgelist ud fra netværksobjektet</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">as_data_frame</span>(net_affil_l, <span class="at">what =</span> <span class="st">"edges"</span>)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fordi det er undirected vil vi gerne 'fordoble' det så from-to og to-from er med</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">from =</span> <span class="fu">c</span>(e<span class="sc">$</span>from, e<span class="sc">$</span>to), </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">to   =</span> <span class="fu">c</span>(e<span class="sc">$</span>to, e<span class="sc">$</span>from))</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dernæst kan vi left_join'e tags på for henholdsvis from variablen og to variablen.</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> e <span class="sc">%&gt;%</span> </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., <span class="fu">tibble</span>(<span class="at">from =</span> <span class="fu">V</span>(net_affil_l)<span class="sc">$</span>name, <span class="at">from_sector =</span> <span class="fu">V</span>(net_affil_l)<span class="sc">$</span>sector)) <span class="sc">%&gt;%</span> </span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., <span class="fu">tibble</span>(<span class="at">to =</span> <span class="fu">V</span>(net_affil_l)<span class="sc">$</span>name, <span class="at">to_sector =</span> <span class="fu">V</span>(net_affil_l)<span class="sc">$</span>sector))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(from)`
Joining with `by = join_by(to)`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># og lave en summarise(....., .by = from_tag), hvor vi 1. tæller hvor mange der har tag'et og dernæst hvor mange af hvert tags forbindelser, der er til det samme tag og hvor mange der er til et andet tag.</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>e <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nodes     =</span> <span class="fu">n_distinct</span>(from) , <span class="at">ties_within =</span> <span class="fu">sum</span>(from_sector <span class="sc">==</span> to_sector),</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">ties_out  =</span> <span class="fu">sum</span>(from_sector <span class="sc">!=</span> to_sector),</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">share_out =</span> ties_out <span class="sc">/</span> (ties_within <span class="sc">+</span> ties_out), <span class="at">.by =</span> from_sector)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  from_sector  nodes ties_within ties_out share_out
  &lt;chr&gt;        &lt;int&gt;       &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;
1 Corporations    89         304      358     0.541
2 NGO             68         248      365     0.595
3 State           27          88      177     0.668
4 Commissions      1           0        8     1    
5 Unknown          1           0        4     1    
6 Family           6           0        9     1    
7 Foundations     12           0       44     1    
8 VL_networks     68          24      317     0.930</code></pre>
</div>
</div>
<p>Eller hvad med andel af out-going ties fra sektor til sektor:</p>
<div class="cell" data-warnings="false" data-messages="false">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>sector_tie_table <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(e, <span class="at">formula =</span> <span class="sc">~</span>from_sector <span class="sc">+</span> to_sector)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(sector_tie_table) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(sector_tie_table, <span class="at">margin =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              to_sector
from_sector    Commissions Corporations Family Foundations   NGO State Unknown
  Commissions        0.000        0.125  0.000       0.000 0.000 0.875   0.000
  Corporations       0.003        0.000  0.000       0.050 0.441 0.162   0.006
  Family             0.000        0.000  0.000       0.000 0.556 0.222   0.000
  Foundations        0.000        0.409  0.000       0.000 0.318 0.068   0.000
  NGO                0.000        0.433  0.014       0.038 0.000 0.148   0.003
  State              0.040        0.328  0.011       0.017 0.305 0.000   0.006
  Unknown            0.000        0.500  0.000       0.000 0.250 0.250   0.000
  VL_networks        0.000        0.382  0.006       0.028 0.420 0.164   0.000
              to_sector
from_sector    VL_networks
  Commissions        0.000
  Corporations       0.338
  Family             0.222
  Foundations        0.205
  NGO                0.364
  State              0.294
  Unknown            0.000
  VL_networks        0.000</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>